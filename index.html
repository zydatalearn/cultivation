<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>‰øÆ‰ªôÊ®°ÊãüÂô® v4.3 - Ë£ÖÂ§áÁ≥ªÁªü‰ºòÂåñÁâà</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ÁôΩÈáë‰∏ªÈ¢ò - Âü∫Á°ÄÊ†∑Âºè */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Microsoft YaHei', 'Segoe UI', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa, #c3cfe2);
            color: #333;
            min-height: 100vh;
            overflow-x: hidden;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0;
            padding: 10px;
            position: relative;
        }
        
        .game-wrapper {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.1), 
                        0 0 30px rgba(212, 175, 55, 0.1);
            position: relative;
            overflow: hidden;
            border: 3px solid #d4af37;
            width: 100%;
        }
        
        .game-wrapper::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(to right, #d4af37, #f5f5dc, #c0c0c0);
            z-index: 10;
        }
        
        header {
            text-align: center;
            padding: 15px;
            margin-bottom: 0;
            position: relative;
            background: linear-gradient(to bottom, rgba(212, 175, 55, 0.1), transparent);
        }
        
        h1 {
            font-size: 1.6rem;
            background: linear-gradient(to right, #b8860b, #d4af37, #daa520);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: 2px;
            margin-bottom: 0;
            font-weight: 800;
            position: relative;
            display: inline-block;
            text-shadow: 0 2px 10px rgba(212, 175, 55, 0.2);
            padding: 0 10px;
        }
        
        .subtitle {
            font-size: 0.8rem;
            color: #b8860b;
            font-style: italic;
            margin-top: 2px;
            text-shadow: 0 0 8px rgba(184, 134, 11, 0.3);
        }
        
        .game-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 12px;
            padding: 0 10px;
        }
        
        @media (min-width: 992px) {
            .game-container {
                flex-direction: row;
            }
        }
        
        .main-content {
            flex: 3;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .side-content {
            flex: 2;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .panel {
            background: rgba(248, 249, 250, 0.9);
            border-radius: 12px;
            padding: 12px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.05);
            border: 2px solid #d4af37;
            position: relative;
            overflow: hidden;
        }
        
        .panel::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(to right, #d4af37, #daa520);
            z-index: 1;
        }
        
        .panel-title {
            font-size: 1.1rem;
            color: #b8860b;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 6px;
            position: relative;
            padding-bottom: 6px;
            border-bottom: 2px solid rgba(212, 175, 55, 0.3);
        }
        
        .panel-title i {
            color: #d4af37;
            font-size: 1rem;
        }
        
        /* ÈÄâÈ°πÂç°Ê†∑Âºè */
        .tab-container {
            display: flex;
            border-bottom: 2px solid rgba(212, 175, 55, 0.2);
            margin-bottom: 12px;
            flex-wrap: wrap;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .tab {
            padding: 8px 12px;
            cursor: pointer;
            color: #666;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
            font-weight: 500;
            white-space: nowrap;
            flex-shrink: 0;
            font-size: 0.85rem;
        }
        
        .tab.active {
            color: #b8860b;
            border-bottom-color: #d4af37;
            background: rgba(212, 175, 55, 0.1);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Â§©ËµãÂç°Áâá - Áº©Â∞èÁâà */
        .buff-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 6px;
            margin-bottom: 12px;
        }
        
        @media (min-width: 768px) {
            .buff-container {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        
        @media (min-width: 992px) {
            .buff-container {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        .buff-card {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 6px;
            padding: 8px;
            width: 100%;
            border: 2px solid #d4af37;
            position: relative;
            transition: all 0.3s ease;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            min-height: 90px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        }
        
        .buff-card:hover, .buff-card:active {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(212, 175, 55, 0.15);
            border-color: #b8860b;
        }
        
        .buff-card.selected {
            border-width: 2px;
            box-shadow: 0 0 15px rgba(184, 134, 11, 0.25);
            background: rgba(212, 175, 55, 0.08);
        }
        
        .buff-card.common {
            border-color: #999;
        }
        
        .buff-card.rare {
            border-color: #4682b4;
        }
        
        .buff-card.epic {
            border-color: #9370db;
        }
        
        .buff-card.legendary {
            border-color: #daa520;
            animation: pulse 2s infinite;
        }
        
        .buff-card.mythic {
            border-color: #ff4500;
            animation: pulse-glow 1.5s infinite alternate;
        }
        
        .buff-rarity {
            position: absolute;
            top: 5px;
            right: 5px;
            font-size: 0.65rem;
            padding: 2px 6px;
            border-radius: 6px;
            font-weight: bold;
            color: white;
        }
        
        .common .buff-rarity {
            background: linear-gradient(135deg, #999, #bbb);
        }
        
        .rare .buff-rarity {
            background: linear-gradient(135deg, #4682b4, #5f9ea0);
        }
        
        .epic .buff-rarity {
            background: linear-gradient(135deg, #9370db, #ba55d3);
        }
        
        .legendary .buff-rarity {
            background: linear-gradient(135deg, #daa520, #ff8c00);
        }
        
        .mythic .buff-rarity {
            background: linear-gradient(135deg, #ff4500, #ff6347);
        }
        
        .buff-name {
            font-size: 0.8rem;
            margin-bottom: 4px;
            color: #333;
            font-weight: bold;
            padding-right: 45px;
            line-height: 1.2;
        }
        
        .buff-desc {
            font-size: 0.7rem;
            color: #666;
            min-height: 35px;
            line-height: 1.3;
        }
        
        .buff-select {
            margin-top: 4px;
            text-align: center;
            color: #b8860b;
            font-weight: bold;
            display: none;
            font-size: 0.7rem;
        }
        
        .buff-card.selected .buff-select {
            display: block;
        }
        
        .lock-icon {
            position: absolute;
            top: 5px;
            left: 5px;
            color: #d4af37;
            cursor: pointer;
            font-size: 0.75rem;
            z-index: 2;
            background: rgba(255, 255, 255, 0.9);
            width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            border: 1px solid rgba(212, 175, 55, 0.5);
            -webkit-tap-highlight-color: transparent;
        }
        
        .lock-icon.locked {
            color: #b8860b;
            background: rgba(184, 134, 11, 0.1);
            border-color: #b8860b;
        }
        
        /* ÊåâÈíÆÊ†∑Âºè */
        .btn {
            background: linear-gradient(to right, #d4af37, #daa520);
            color: #333;
            border: none;
            padding: 10px 16px;
            border-radius: 25px;
            font-size: 0.9rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            box-shadow: 0 6px 20px rgba(212, 175, 55, 0.2);
            position: relative;
            overflow: hidden;
            z-index: 1;
            border: 1px solid rgba(184, 134, 11, 0.5);
            width: 100%;
            margin-bottom: 8px;
            -webkit-tap-highlight-color: transparent;
        }
        
        .btn::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to right, #daa520, #d4af37);
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: -1;
        }
        
        .btn:hover, .btn:active {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(212, 175, 55, 0.3);
            color: #333;
        }
        
        .btn:hover::before, .btn:active::before {
            opacity: 1;
        }
        
        .btn:disabled {
            background: #ccc;
            color: #888;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
            border-color: #bbb;
        }
        
        .btn:disabled:hover::before {
            opacity: 0;
        }
        
        /* ÁÅµÂäõÊòæÁ§∫ */
        .spirit-power {
            font-size: 1.4rem;
            color: #4682b4;
            text-align: center;
            margin: 15px 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }
        
        .spirit-icon {
            display: inline-block;
            width: 36px;
            height: 36px;
            background: linear-gradient(135deg, #d4af37, #daa520, #4682b4);
            border-radius: 50%;
            position: relative;
            animation: float 3s ease-in-out infinite;
        }
        
        .spirit-icon::after {
            content: "‚ö°";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 18px;
        }
        
        .spirit-per-minute {
            font-size: 0.8rem;
            color: #b8860b;
            background: rgba(212, 175, 55, 0.2);
            padding: 5px 12px;
            border-radius: 15px;
            margin-top: 6px;
            border: 1px solid rgba(184, 134, 11, 0.3);
        }
        
        .action-buttons {
            display: flex;
            gap: 8px;
            margin-top: 12px;
            flex-wrap: wrap;
        }
        
        .action-buttons .btn {
            margin-bottom: 0;
        }
        
        .cultivate-btn {
            flex: 1;
            text-align: center;
            padding: 8px;
            min-width: auto;
        }
        
        /* ÊàòÊñóÂå∫Âüü */
        .monster-battle {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 12px;
            padding: 12px;
            border: 2px solid #d4af37;
            position: relative;
        }
        
        .monster-name {
            font-size: 1.2rem;
            color: #dc143c;
            text-align: center;
            margin-bottom: 8px;
            font-weight: bold;
            text-shadow: 0 2px 5px rgba(220, 20, 60, 0.2);
        }
        
        .monster-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 6px;
            margin-bottom: 10px;
        }
        
        .stat {
            text-align: center;
            padding: 8px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 6px;
            min-width: auto;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
            border: 1px solid rgba(212, 175, 55, 0.5);
        }
        
        .stat-value {
            font-size: 1rem;
            color: #4682b4;
            font-weight: bold;
        }
        
        .stat-label {
            font-size: 0.8rem;
            color: #666;
        }
        
        .battle-info {
            height: 70px;
            overflow-y: auto;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 6px;
            padding: 10px;
            margin-top: 8px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-size: 0.85rem;
            border: 1px solid rgba(212, 175, 55, 0.5);
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* ËøõÂ∫¶Êù° */
        .progress-container {
            margin: 15px 0;
            position: relative;
        }
        
        .progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 0.9rem;
            color: #b8860b;
        }
        
        .progress-bar {
            height: 20px;
            background: rgba(212, 175, 55, 0.1);
            border-radius: 10px;
            overflow: hidden;
            position: relative;
            border: 1px solid rgba(212, 175, 55, 0.5);
            box-shadow: inset 0 0 8px rgba(0, 0, 0, 0.05);
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(to right, #d4af37, #daa520);
            width: 0%;
            transition: width 0.5s ease;
            position: relative;
        }
        
        .progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #333;
            font-weight: bold;
            font-size: 0.85rem;
            text-shadow: 0 1px 2px rgba(255,255,255,0.5);
        }
        
        .refresh-counter {
            background: rgba(212, 175, 55, 0.2);
            padding: 8px 12px;
            border-radius: 15px;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            margin-top: 10px;
            border: 1px solid rgba(184, 134, 11, 0.3);
            font-size: 0.9rem;
            color: #666;
        }
        
        .footer {
            text-align: center;
            padding: 15px;
            margin-top: 12px;
            color: #666;
            font-size: 0.8rem;
            border-top: 1px solid rgba(212, 175, 55, 0.3);
            background: rgba(255, 255, 255, 0.9);
        }
        
        .cultivation-info {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin-top: 8px;
            font-size: 0.85rem;
        }
        
        .info-item {
            display: flex;
            align-items: center;
            gap: 5px;
            background: rgba(212, 175, 55, 0.1);
            padding: 6px 10px;
            border-radius: 15px;
            color: #666;
            font-size: 0.8rem;
            border: 1px solid rgba(184, 134, 11, 0.2);
        }
        
        .info-value {
            color: #4682b4;
            font-weight: bold;
        }
        
        .cultivation-stage {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 12px;
            padding: 10px;
            background: rgba(212, 175, 55, 0.1);
            border-radius: 8px;
            border: 1px solid rgba(212, 175, 55, 0.3);
        }
        
        .stage-info {
            text-align: center;
        }
        
        .stage-name {
            font-size: 1rem;
            color: #b8860b;
            font-weight: bold;
            margin-bottom: 4px;
        }
        
        .stage-level {
            font-size: 0.9rem;
            color: #666;
        }
        
        /* ‰∫∫Áâ©Â±ûÊÄßÂç°Áâá */
        .character-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin-top: 12px;
        }
        
        .stat-card {
            flex: 1;
            min-width: auto;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 8px;
            padding: 10px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            border: 1px solid rgba(212, 175, 55, 0.5);
        }
        
        .stat-card-title {
            font-size: 0.85rem;
            color: #666;
            margin-bottom: 6px;
        }
        
        .stat-card-value {
            font-size: 1.1rem;
            color: #b8860b;
            font-weight: bold;
        }
        
        .stat-card-add {
            margin-top: 6px;
            padding: 5px 10px;
            background: linear-gradient(to right, #d4af37, #daa520);
            color: #333;
            border: none;
            border-radius: 12px;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
        }
        
        .stat-card-add:hover {
            background: linear-gradient(to right, #daa520, #d4af37);
        }
        
        /* ÊÄ™Áâ©ÈÄâÊã© */
        .monster-selection {
            display: flex;
            overflow-x: auto;
            gap: 8px;
            margin-top: 10px;
            padding-bottom: 6px;
            scrollbar-width: thin;
            -webkit-overflow-scrolling: touch;
        }
        
        .monster-option {
            flex: 0 0 auto;
            min-width: 90px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 8px;
            padding: 10px;
            text-align: center;
            cursor: pointer;
            border: 2px solid rgba(212, 175, 55, 0.7);
            transition: all 0.3s ease;
            font-size: 0.8rem;
            -webkit-tap-highlight-color: transparent;
        }
        
        .monster-option:hover, .monster-option:active {
            border-color: #b8860b;
            transform: translateY(-3px);
        }
        
        .monster-option.selected {
            border-color: #daa520;
            background: rgba(218, 165, 32, 0.1);
        }
        
        .monster-level {
            font-size: 0.85rem;
            color: #b8860b;
            font-weight: bold;
            margin-bottom: 4px;
        }
        
        .monster-reward {
            font-size: 0.75rem;
            color: #666;
        }
        
        /* Â§çÊ¥ªÁïåÈù¢ */
        .resurrect-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.95);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 20;
            border-radius: 12px;
        }
        
        .resurrect-title {
            font-size: 1.2rem;
            color: #dc143c;
            margin-bottom: 12px;
            text-align: center;
        }
        
        .resurrect-timer {
            font-size: 1.6rem;
            font-weight: bold;
            color: #b8860b;
            text-align: center;
        }
        
        /* Â±ûÊÄßÂä†ÁÇπ */
        .attribute-points {
            margin-top: 12px;
            padding: 12px;
            background: rgba(212, 175, 55, 0.1);
            border-radius: 8px;
            border: 1px solid rgba(212, 175, 55, 0.3);
        }
        
        .attribute-title {
            font-size: 1rem;
            color: #b8860b;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .attribute-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin-top: 10px;
        }
        
        .attribute-item {
            padding: 10px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 6px;
            border: 1px solid rgba(212, 175, 55, 0.3);
        }
        
        .attribute-name {
            font-weight: bold;
            color: #b8860b;
            margin-bottom: 5px;
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
        }
        
        .attribute-value {
            color: #4682b4;
            font-weight: bold;
            font-size: 0.9rem;
        }
        
        .attribute-cost {
            color: #daa520;
            font-size: 0.8rem;
            margin-top: 4px;
        }
        
        .attribute-add {
            margin-top: 6px;
            padding: 6px 10px;
            background: linear-gradient(to right, #d4af37, #daa520);
            color: #333;
            border: none;
            border-radius: 12px;
            font-size: 0.8rem;
            cursor: pointer;
            width: 100%;
        }
        
        .crit-text {
            animation: critAnimation 0.5s ease-in-out;
            color: #dc143c;
            font-weight: bold;
        }
        
        .gold-border {
            border: 2px solid #d4af37;
            border-radius: 8px;
            padding: 10px;
            margin: 10px 0;
            background: rgba(212, 175, 55, 0.05);
        }
        
        .gold-text {
            color: #daa520;
            font-weight: bold;
        }
        
        /* ÁâπÊÆäÂ±ûÊÄß */
        .special-attributes {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-top: 12px;
        }
        
        .special-attribute {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 6px;
            padding: 8px;
            text-align: center;
            border: 1px solid rgba(212, 175, 55, 0.3);
        }
        
        .special-name {
            font-size: 0.8rem;
            color: #666;
            margin-bottom: 5px;
        }
        
        .special-value {
            font-size: 0.9rem;
            color: #b8860b;
            font-weight: bold;
        }
        
        /* Ë£ÖÂ§áÁ≥ªÁªüÊ†∑Âºè - ‰ºòÂåñÂêéÁöÑÂ∏ÉÂ±Ä */
        .equipment-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-top: 15px;
        }
        
        .equipment-slot {
            background: rgba(255, 255, 255, 0.7);
            border-radius: 8px;
            padding: 12px 8px;
            text-align: center;
            border: 2px dashed rgba(184, 134, 11, 0.5);
            min-height: 90px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s;
            -webkit-tap-highlight-color: transparent;
        }
        
        .equipment-slot:hover, .equipment-slot:active {
            border-color: #b8860b;
            background: rgba(184, 134, 11, 0.1);
        }
        
        .equipment-slot.filled {
            border: 2px solid #d4af37;
            background: rgba(212, 175, 55, 0.1);
        }
        
        .equipment-icon {
            font-size: 1.6rem;
            color: #b8860b;
            margin-bottom: 6px;
        }
        
        .equipment-name {
            font-size: 0.8rem;
            color: #333;
            margin-bottom: 4px;
            font-weight: bold;
        }
        
        .equipment-stats {
            font-size: 0.7rem;
            color: #666;
        }
        
        .inventory-container {
            margin-top: 15px;
            max-height: 300px;
            overflow-y: auto;
            padding: 8px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 8px;
            -webkit-overflow-scrolling: touch;
        }
        
        .inventory-title {
            color: #b8860b;
            margin-bottom: 8px;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .inventory-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 8px;
        }
        
        .inventory-item {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 6px;
            padding: 8px;
            text-align: center;
            border: 1px solid rgba(212, 175, 55, 0.3);
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            -webkit-tap-highlight-color: transparent;
        }
        
        .inventory-item:hover, .inventory-item:active {
            border-color: #b8860b;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(212, 175, 55, 0.1);
        }
        
        .inventory-item.selected {
            border-color: #daa520;
            background: rgba(218, 165, 32, 0.1);
        }
        
        .item-rarity {
            position: absolute;
            top: 4px;
            right: 4px;
            font-size: 0.65rem;
            padding: 1px 5px;
            border-radius: 6px;
            font-weight: bold;
            color: white;
        }
        
        .item-name {
            color: #333;
            font-size: 0.75rem;
            margin-bottom: 4px;
            font-weight: bold;
        }
        
        .item-stats {
            color: #4682b4;
            font-size: 0.7rem;
            margin-bottom: 2px;
        }
        
        .item-type {
            color: #666;
            font-size: 0.65rem;
        }
        
        .item-level {
            color: #daa520;
            font-size: 0.65rem;
            margin-top: 2px;
        }
        
        .equipment-details {
            margin-top: 12px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 8px;
            border: 1px solid rgba(212, 175, 55, 0.3);
            display: none;
        }
        
        .equipment-details.show {
            display: block;
        }
        
        .equipment-details-title {
            color: #b8860b;
            margin-bottom: 8px;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .equipment-details-content {
            color: #666;
            font-size: 0.85rem;
            line-height: 1.4;
        }
        
        .monster-scroll {
            display: flex;
            overflow-x: auto;
            gap: 8px;
            padding-bottom: 6px;
            -webkit-overflow-scrolling: touch;
        }
        
        /* Ëá™Âä®ÊàòÊñóÊåâÈíÆ */
        .auto-battle-btn {
            background: linear-gradient(to right, #2e8b57, #3cb371);
            color: white;
        }
        
        .auto-battle-btn.active {
            background: linear-gradient(to right, #dc143c, #ff4500);
            color: white;
        }
        
        /* ÁßªÂä®Á´ØÂ∫ïÈÉ®ÂØºËà™ */
        .mobile-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: rgba(255, 255, 255, 0.95);
            border-top: 2px solid #d4af37;
            display: flex;
            justify-content: space-around;
            padding: 8px 0;
            z-index: 1000;
            box-shadow: 0 -5px 20px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            font-size: 0.7rem;
            color: #666;
            cursor: pointer;
            padding: 5px 10px;
            border-radius: 8px;
            transition: all 0.3s;
            -webkit-tap-highlight-color: transparent;
        }
        
        .nav-item.active {
            background: rgba(212, 175, 55, 0.2);
            color: #b8860b;
        }
        
        .nav-item i {
            font-size: 1.2rem;
            margin-bottom: 3px;
        }
        
        /* ‰øÆ‰ªôËÉåÊôØË£ÖÈ•∞ */
        .taoist-symbol {
            position: absolute;
            opacity: 0.05;
            font-size: 150px;
            color: #d4af37;
            z-index: -1;
            pointer-events: none;
        }
        
        .symbol-1 {
            top: 40px;
            left: 20px;
            transform: rotate(15deg);
        }
        
        .symbol-2 {
            bottom: 40px;
            right: 20px;
            transform: rotate(-15deg);
        }
        
        /* ÈÄöÁü•Ê∂àÊÅØ */
        .notification {
            position: fixed;
            top: 15px;
            left: 10px;
            right: 10px;
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid #d4af37;
            border-radius: 8px;
            padding: 12px 15px;
            max-width: 100%;
            transform: translateY(-150%);
            transition: transform 0.4s ease;
            z-index: 1000;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            font-size: 0.85rem;
        }
        
        .notification.show {
            transform: translateY(0);
        }
        
        .notification-title {
            color: #b8860b;
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .notification-content {
            font-size: 0.85rem;
            line-height: 1.4;
            color: #666;
        }
        
        /* Âä®ÁîªÊïàÊûú */
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-6px); }
            100% { transform: translateY(0px); }
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(218, 165, 32, 0.4); }
            70% { box-shadow: 0 0 0 12px rgba(218, 165, 32, 0); }
            100% { box-shadow: 0 0 0 0 rgba(218, 165, 32, 0); }
        }
        
        @keyframes pulse-glow {
            0% { box-shadow: 0 0 10px rgba(255, 69, 0, 0.4); }
            100% { box-shadow: 0 0 20px rgba(255, 69, 0, 0.8); }
        }
        
        @keyframes critAnimation {
            0% { transform: scale(1); text-shadow: 0 0 0 rgba(220, 20, 60, 0); }
            50% { transform: scale(1.5); text-shadow: 0 0 20px rgba(220, 20, 60, 0.5); }
            100% { transform: scale(1); text-shadow: 0 0 0 rgba(220, 20, 60, 0); }
        }
        
        @keyframes level-up {
            0% { transform: scale(1); opacity: 0.5; }
            50% { transform: scale(1.2); opacity: 1; }
            100% { transform: scale(1); opacity: 0.5; }
        }
        
        /* Âä†ËΩΩÂä®Áîª */
        .loading {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.95);
            z-index: 9999;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }
        
        .loading.show {
            display: flex;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(212, 175, 55, 0.2);
            border-top: 4px solid #b8860b;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Â≠òÊ°£ÊèêÁ§∫ */
        .save-notification {
            position: fixed;
            bottom: 15px;
            left: 15px;
            background: rgba(70, 130, 180, 0.1);
            border: 1px solid #4682b4;
            border-radius: 8px;
            padding: 6px 10px;
            font-size: 0.75rem;
            color: #4682b4;
            z-index: 999;
            display: none;
        }
        
        .save-notification.show {
            display: block;
            animation: fadeOut 2s ease-in-out 1s forwards;
        }
        
        @keyframes fadeOut {
            0% { opacity: 1; }
            100% { opacity: 0; display: none; }
        }
        
        /* Ëá™Âä®ÂõûÊî∂ËÆæÁΩÆ */
        .auto-recycle-settings {
            margin-top: 12px;
            padding: 12px;
            background: rgba(212, 175, 55, 0.1);
            border-radius: 8px;
            border: 1px solid rgba(212, 175, 55, 0.3);
        }
        
        .auto-recycle-title {
            color: #b8860b;
            margin-bottom: 8px;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .recycle-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin-top: 8px;
        }
        
        .recycle-option {
            padding: 8px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 6px;
            border: 1px solid rgba(212, 175, 55, 0.3);
        }
        
        .recycle-label {
            font-size: 0.85rem;
            color: #666;
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .recycle-select {
            width: 100%;
            padding: 6px;
            border-radius: 4px;
            border: 1px solid rgba(212, 175, 55, 0.5);
            background: white;
            font-size: 0.85rem;
        }
        
        /* ÁßªÂä®Á´Ø‰ºòÂåñ */
        @media (max-width: 767px) {
            .game-wrapper {
                border-radius: 10px;
                margin-bottom: 60px;
            }
            
            .panel {
                padding: 12px;
            }
            
            .btn {
                padding: 12px 16px;
                font-size: 0.95rem;
            }
            
            .monster-option {
                min-width: 100px;
                padding: 12px;
            }
            
            .stat {
                padding: 10px;
            }
            
            .buff-card {
                min-height: 85px;
                padding: 8px;
            }
            
            .equipment-grid {
                gap: 8px;
            }
            
            .equipment-slot {
                min-height: 80px;
                padding: 10px 6px;
            }
            
            .inventory-grid {
                grid-template-columns: repeat(auto-fill, minmax(95px, 1fr));
            }
        }
        
        /* Ëß¶Êë∏ÂèçÈ¶à */
        .touch-feedback {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border-radius: inherit;
            background: rgba(212, 175, 55, 0.1);
            opacity: 0;
            transition: opacity 0.2s;
            pointer-events: none;
        }
        
        .btn:active .touch-feedback,
        .buff-card:active .touch-feedback,
        .monster-option:active .touch-feedback,
        .inventory-item:active .touch-feedback {
            opacity: 1;
        }
        
        /* ÈïøÊåâÊèêÁ§∫ */
        .long-press-hint {
            position: absolute;
            bottom: -18px;
            left: 0;
            right: 0;
            font-size: 0.65rem;
            color: #999;
            text-align: center;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .equipment-slot:hover .long-press-hint,
        .inventory-item:hover .long-press-hint {
            opacity: 1;
        }
        
        /* ÈÄâ‰∏≠Â§©ËµãÂÆπÂô® */
        .selected-buffs-container {
            margin-top: 12px;
            padding: 12px;
            background: rgba(212, 175, 55, 0.1);
            border-radius: 8px;
            border: 1px solid rgba(212, 175, 55, 0.3);
        }
        
        .selected-buffs-title {
            color: #b8860b;
            margin-bottom: 8px;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .selected-buffs-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
        }
        
        /* ÊàòÊñóÁä∂ÊÄÅÊåáÁ§∫Âô® */
        .battle-status {
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
            padding: 8px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 6px;
            border: 1px solid rgba(212, 175, 55, 0.3);
        }
        
        .status-item {
            text-align: center;
        }
        
        .status-label {
            font-size: 0.75rem;
            color: #666;
        }
        
        .status-value {
            font-size: 0.9rem;
            color: #4682b4;
            font-weight: bold;
        }
        
        /* Â≠òÊ°£ÁÆ°ÁêÜ */
        .save-manager {
            margin-top: 12px;
            padding: 12px;
            background: rgba(212, 175, 55, 0.1);
            border-radius: 8px;
            border: 1px solid rgba(212, 175, 55, 0.3);
        }
        
        .save-manager-title {
            color: #b8860b;
            margin-bottom: 8px;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .save-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin-top: 8px;
        }
        
        /* Êñ∞Â¢ûÔºöÈáçÁΩÆÊ∏∏ÊàèÊåâÈíÆ */
        .reset-btn {
            background: linear-gradient(to right, #dc143c, #ff4500);
            color: white;
        }
        
        /* Êñ∞Â¢ûÔºöÂΩìÂâçÂ¢ÉÁïåÊòæÁ§∫ */
        .current-stage-display {
            display: inline-block;
            background: rgba(212, 175, 55, 0.2);
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.9rem;
            color: #b8860b;
            font-weight: bold;
            margin-left: 10px;
        }
        
        /* Êñ∞Â¢ûÔºöÂ¢ÉÁïå‰øÆÁÇºËøõÂ∫¶ */
        .cultivation-progress-container {
            margin: 15px 0;
            position: relative;
        }
        
        .cultivation-progress-bar {
            height: 20px;
            background: rgba(212, 175, 55, 0.1);
            border-radius: 10px;
            overflow: hidden;
            position: relative;
            border: 1px solid rgba(212, 175, 55, 0.5);
            box-shadow: inset 0 0 8px rgba(0, 0, 0, 0.05);
        }
        
        .cultivation-progress-fill {
            height: 100%;
            background: linear-gradient(to right, #8a2be2, #9370db);
            width: 0%;
            transition: width 0.5s ease;
            position: relative;
        }
        
        .cultivation-progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #333;
            font-weight: bold;
            font-size: 0.85rem;
            text-shadow: 0 1px 2px rgba(255,255,255,0.5);
        }
        
        /* Êñ∞Â¢ûÔºöË£ÖÂ§áÂ±ûÊÄßÂ±ïÁ§∫ */
        .equipment-bonus-display {
            margin-top: 12px;
            padding: 12px;
            background: rgba(70, 130, 180, 0.1);
            border-radius: 8px;
            border: 1px solid rgba(70, 130, 180, 0.3);
        }
        
        .equipment-bonus-title {
            color: #4682b4;
            margin-bottom: 8px;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .equipment-bonus-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
        }
        
        .equipment-bonus-item {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 6px;
            padding: 8px;
            text-align: center;
            border: 1px solid rgba(70, 130, 180, 0.3);
        }
        
        .equipment-bonus-name {
            font-size: 0.8rem;
            color: #666;
            margin-bottom: 4px;
        }
        
        .equipment-bonus-value {
            font-size: 0.9rem;
            color: #4682b4;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <!-- Âä†ËΩΩÂä®Áîª -->
    <div class="loading" id="loading">
        <div class="spinner"></div>
        <div style="color: #b8860b; font-size: 1rem;">Âä†ËΩΩ‰øÆ‰ªô‰∏ñÁïå...</div>
    </div>
    
    <!-- Â≠òÊ°£ÊèêÁ§∫ -->
    <div class="save-notification" id="save-notification">
        <i class="fas fa-save"></i> Ê∏∏ÊàèÂ∑≤Ëá™Âä®‰øùÂ≠ò
    </div>
    
    <!-- ÈÄöÁü•Ê∂àÊÅØ -->
    <div class="notification" id="notification">
        <div class="notification-title"><i class="fas fa-info-circle"></i> <span id="notification-title">Á≥ªÁªüÊèêÁ§∫</span></div>
        <div class="notification-content" id="notification-content">ËØ∑ÈÄâÊã©‰∏§‰∏™Â§©ËµãÂºÄÂßã‰øÆ‰ªô‰πãÊóÖ</div>
    </div>
    
    <div class="taoist-symbol symbol-1">‚òØ</div>
    <div class="taoist-symbol symbol-2">‚òØ</div>
    
    <div class="container">
        <div class="game-wrapper">
            <header>
                <h1>‰øÆ‰ªôÊ®°ÊãüÂô® v4.3 - Ë£ÖÂ§áÁ≥ªÁªü‰ºòÂåñÁâà</h1>
                <p class="subtitle">ÁÇºÊ∞îÂåñÁ•û ¬∑ ÁÇºÁ•ûËøòËôö ¬∑ ÁÇºËôöÂêàÈÅì ¬∑ Ê∏°Âä´È£ûÂçá</p>
            </header>
            
            <div class="game-container">
                <div class="main-content">
                    <!-- Â§©ËµãÈÄâÊã©Èù¢Êùø -->
                    <div class="panel" id="talent-panel">
                        <div class="tab-container">
                            <div class="tab active" data-tab="talents">Â§©ËµãÈÄâÊã©</div>
                            <div class="tab" data-tab="equipment">Ë£ÖÂ§áÁ≥ªÁªü</div>
                            <div class="tab" data-tab="recycle">Ëá™Âä®ÂõûÊî∂</div>
                            <div class="tab" data-tab="saves">Â≠òÊ°£ÁÆ°ÁêÜ</div>
                        </div>
                        
                        <!-- Â§©ËµãÈÄâÊã©ÂÜÖÂÆπ -->
                        <div class="tab-content active" id="talents-content">
                            <h2 class="panel-title"><i class="fas fa-magic"></i> ÂºÄÂ±ÄÂ§©Ëµã</h2>
                            <p style="font-size: 0.85rem; color: #666; margin-bottom: 8px;">ËØ∑‰ªé‰ª•‰∏ãÂ§©Ëµã‰∏≠ÈÄâÊã©‰∏§‰∏™ÔºåÂà∑Êñ∞Ê¨°Êï∞: <span id="refresh-count">10</span> Ê¨°</p>
                            
                            <div class="buff-container" id="buff-container">
                                <!-- Buffs will be generated here -->
                            </div>
                            
                            <div class="action-buttons">
                                <button class="btn" id="refresh-btn"><i class="fas fa-sync-alt"></i> Âà∑Êñ∞Â§©Ëµã</button>
                                <button class="btn" id="start-btn" disabled><i class="fas fa-play"></i> ÂºÄÂßã‰øÆ‰ªô</button>
                                <button class="btn reset-btn" id="reset-game-btn"><i class="fas fa-redo"></i> ÈáçÁΩÆÊ∏∏Êàè</button>
                            </div>
                            
                            <div class="refresh-counter">
                                <i class="fas fa-redo"></i> Ââ©‰ΩôÂà∑Êñ∞Ê¨°Êï∞: <span id="refresh-counter">10</span>Ê¨°
                            </div>
                            
                            <div class="cultivation-stage">
                                <div class="stage-info">
                                    <div class="stage-name">Â∑≤ÈÄâÂ§©Ëµã</div>
                                    <div class="stage-level"><span id="selected-buffs-count">0</span>/2</div>
                                </div>
                                <div class="stage-info">
                                    <div class="stage-name">ÂàùÂßãÂ¢ÉÁïå</div>
                                    <div class="stage-level">ÁÇºÊ∞îÂàùÊúü</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Ë£ÖÂ§áÁ≥ªÁªüÂÜÖÂÆπ - ‰ºòÂåñÁâà -->
                        <div class="tab-content" id="equipment-content">
                            <h2 class="panel-title"><i class="fas fa-shield-alt"></i> Ë£ÖÂ§áÁ≥ªÁªü v4.3</h2>
                            <p style="font-size: 0.85rem; color: #666; margin-bottom: 8px;">Á©øÊà¥Ë£ÖÂ§áÊèêÂçáÂ±ûÊÄßÔºåÂáªË¥•ÊÄ™Áâ©ÊúâÂá†ÁéáÊéâËêΩË£ÖÂ§áÔºåÊÄ™Áâ©Ë∂äÂº∫ÊéâËêΩË∂äÂ•ΩÔºÅ</p>
                            
                            <!-- Ë£ÖÂ§áÊ†è - ‰ºòÂåñÂêéÁöÑÂ∏ÉÂ±Ä -->
                            <div class="equipment-grid" id="equipment-grid">
                                <!-- Ê≠¶Âô®ÊßΩ -->
                                <div class="equipment-slot" data-slot="weapon">
                                    <div class="equipment-icon">‚öîÔ∏è</div>
                                    <div class="equipment-name">Ê≠¶Âô®</div>
                                    <div class="equipment-stats">Êú™Ë£ÖÂ§á</div>
                                    <div class="long-press-hint">ÈïøÊåâËÑ±‰∏ã</div>
                                </div>
                                <!-- Êä§Áî≤ÊßΩ -->
                                <div class="equipment-slot" data-slot="armor">
                                    <div class="equipment-icon">üõ°Ô∏è</div>
                                    <div class="equipment-name">Êä§Áî≤</div>
                                    <div class="equipment-stats">Êú™Ë£ÖÂ§á</div>
                                    <div class="long-press-hint">ÈïøÊåâËÑ±‰∏ã</div>
                                </div>
                                <!-- ÊâãÊßΩ -->
                                <div class="equipment-slot" data-slot="hand">
                                    <div class="equipment-icon">‚úã</div>
                                    <div class="equipment-name">Êâã</div>
                                    <div class="equipment-stats">Êú™Ë£ÖÂ§á</div>
                                    <div class="long-press-hint">ÈïøÊåâËÑ±‰∏ã</div>
                                </div>
                                <!-- ÊàíÊåáÊßΩ -->
                                <div class="equipment-slot" data-slot="ring">
                                    <div class="equipment-icon">üíç</div>
                                    <div class="equipment-name">ÊàíÊåá</div>
                                    <div class="equipment-stats">Êú™Ë£ÖÂ§á</div>
                                    <div class="long-press-hint">ÈïøÊåâËÑ±‰∏ã</div>
                                </div>
                                <!-- È°πÈìæÊßΩ -->
                                <div class="equipment-slot" data-slot="necklace">
                                    <div class="equipment-icon">üìø</div>
                                    <div class="equipment-name">È°πÈìæ</div>
                                    <div class="equipment-stats">Êú™Ë£ÖÂ§á</div>
                                    <div class="long-press-hint">ÈïøÊåâËÑ±‰∏ã</div>
                                </div>
                                <!-- ÈûãÊßΩ -->
                                <div class="equipment-slot" data-slot="shoe">
                                    <div class="equipment-icon">üëü</div>
                                    <div class="equipment-name">Èûã</div>
                                    <div class="equipment-stats">Êú™Ë£ÖÂ§á</div>
                                    <div class="long-press-hint">ÈïøÊåâËÑ±‰∏ã</div>
                                </div>
                            </div>
                            
                            <!-- Ë£ÖÂ§áËØ¶ÊÉÖ -->
                            <div class="equipment-details" id="equipment-details">
                                <div class="equipment-details-title">
                                    <i class="fas fa-info-circle"></i> Ë£ÖÂ§áËØ¶ÊÉÖ
                                </div>
                                <div class="equipment-details-content" id="equipment-details-content">
                                    ÁÇπÂáªË£ÖÂ§áÊü•ÁúãËØ¶ÁªÜ‰ø°ÊÅØ
                                </div>
                            </div>
                            
                            <!-- Ë£ÖÂ§áÂä†ÊàêÊòæÁ§∫ -->
                            <div class="equipment-bonus-display">
                                <div class="equipment-bonus-title">
                                    <i class="fas fa-gem"></i> ÂΩìÂâçË£ÖÂ§áÂä†Êàê
                                </div>
                                <div class="equipment-bonus-grid">
                                    <div class="equipment-bonus-item">
                                        <div class="equipment-bonus-name">ÊîªÂáªÂä†Êàê</div>
                                        <div class="equipment-bonus-value" id="total-attack-bonus">0</div>
                                    </div>
                                    <div class="equipment-bonus-item">
                                        <div class="equipment-bonus-name">Èò≤Âæ°Âä†Êàê</div>
                                        <div class="equipment-bonus-value" id="total-defense-bonus">0</div>
                                    </div>
                                    <div class="equipment-bonus-item">
                                        <div class="equipment-bonus-name">ÁîüÂëΩÂä†Êàê</div>
                                        <div class="equipment-bonus-value" id="total-hp-bonus">0</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- ËÉåÂåÖ -->
                            <div class="inventory-container">
                                <div class="inventory-title">
                                    <i class="fas fa-backpack"></i> ËÉåÂåÖ ( <span id="inventory-count">0</span> / 30 )
                                </div>
                                <div class="inventory-grid" id="inventory-grid">
                                    <!-- ËÉåÂåÖÁâ©ÂìÅÂ∞ÜÂú®ËøôÈáåÊòæÁ§∫ -->
                                </div>
                                <p style="text-align: center; color: #999; margin-top: 8px; font-size: 0.85rem;">ÂèåÂáªË£ÖÂ§áÁ©øÊà¥ÔºåÈïøÊåâË£ÖÂ§áÊßΩËÑ±‰∏ã</p>
                            </div>
                            
                            <div class="action-buttons">
                                <button class="btn" id="sell-equipment-btn" disabled><i class="fas fa-coins"></i> Âá∫ÂîÆÈÄâ‰∏≠Ë£ÖÂ§á</button>
                            </div>
                        </div>
                        
                        <!-- Ëá™Âä®ÂõûÊî∂ÂÜÖÂÆπ -->
                        <div class="tab-content" id="recycle-content">
                            <h2 class="panel-title"><i class="fas fa-recycle"></i> Ëá™Âä®ÂõûÊî∂ËÆæÁΩÆ</h2>
                            <p style="font-size: 0.85rem; color: #666; margin-bottom: 8px;">Ëá™Âä®ÂõûÊî∂‰∏çÈúÄË¶ÅÁöÑË£ÖÂ§áÔºåËΩ¨Âåñ‰∏∫ÁÅµÂäõ</p>
                            
                            <div class="auto-recycle-settings">
                                <div class="auto-recycle-title">
                                    <i class="fas fa-cog"></i> ÂõûÊî∂ËÆæÁΩÆ
                                </div>
                                
                                <div class="recycle-options">
                                    <div class="recycle-option">
                                        <div class="recycle-label">
                                            <i class="fas fa-level-up-alt"></i> Á≠âÁ∫ß‰Ωé‰∫é
                                        </div>
                                        <select class="recycle-select" id="recycle-level">
                                            <option value="0">ÂÖ≥Èó≠</option>
                                            <option value="5" selected>5Á∫ß</option>
                                            <option value="10">10Á∫ß</option>
                                            <option value="15">15Á∫ß</option>
                                            <option value="20">20Á∫ß</option>
                                            <option value="25">25Á∫ß</option>
                                        </select>
                                    </div>
                                    
                                    <div class="recycle-option">
                                        <div class="recycle-label">
                                            <i class="fas fa-gem"></i> ÂìÅË¥®‰Ωé‰∫é
                                        </div>
                                        <select class="recycle-select" id="recycle-rarity">
                                            <option value="common" selected>ÊôÆÈÄö</option>
                                            <option value="rare">Á®ÄÊúâ</option>
                                            <option value="epic">Âè≤ËØó</option>
                                            <option value="legendary">‰º†ËØ¥</option>
                                            <option value="none">ÂÖ≥Èó≠</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div style="margin-top: 12px; padding: 8px; background: rgba(255, 255, 255, 0.9); border-radius: 6px; font-size: 0.85rem; color: #666;">
                                    <i class="fas fa-info-circle"></i> Ëá™Âä®ÂõûÊî∂Â∞ÜÂú®ÂáªË¥•ÊÄ™Áâ©Ëé∑ÂæóË£ÖÂ§áÊó∂Ëá™Âä®ÊâßË°åÔºåÂõûÊî∂Ë£ÖÂ§áÂ∞ÜËΩ¨Âåñ‰∏∫Âéü‰ª∑70%ÁöÑÁÅµÂäõ„ÄÇ
                                </div>
                            </div>
                            
                            <div class="auto-recycle-settings">
                                <div class="auto-recycle-title">
                                    <i class="fas fa-history"></i> ÂõûÊî∂ÁªüËÆ°
                                </div>
                                <div class="recycle-options">
                                    <div class="recycle-option">
                                        <div class="recycle-label">
                                            <i class="fas fa-coins"></i> Á¥ØËÆ°ÂõûÊî∂ÁÅµÂäõ
                                        </div>
                                        <div style="font-size: 1.1rem; color: #b8860b; font-weight: bold; text-align: center;" id="total-recycled-spirit">0</div>
                                    </div>
                                    
                                    <div class="recycle-option">
                                        <div class="recycle-label">
                                            <i class="fas fa-trash"></i> Á¥ØËÆ°ÂõûÊî∂Ë£ÖÂ§á
                                        </div>
                                        <div style="font-size: 1.1rem; color: #b8860b; font-weight: bold; text-align: center;" id="total-recycled-items">0</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="action-buttons">
                                <button class="btn" id="manual-recycle-btn"><i class="fas fa-broom"></i> Á´ãÂç≥ÂõûÊî∂ËÉåÂåÖ</button>
                                <button class="btn" id="save-settings-btn"><i class="fas fa-save"></i> ‰øùÂ≠òËÆæÁΩÆ</button>
                            </div>
                        </div>
                        
                        <!-- Â≠òÊ°£ÁÆ°ÁêÜÂÜÖÂÆπ -->
                        <div class="tab-content" id="saves-content">
                            <h2 class="panel-title"><i class="fas fa-save"></i> Â≠òÊ°£ÁÆ°ÁêÜ</h2>
                            <p style="font-size: 0.85rem; color: #666; margin-bottom: 8px;">ÁÆ°ÁêÜÊ∏∏ÊàèÂ≠òÊ°£ÔºåÊîØÊåÅÂ§çÂà∂Á≤òË¥¥Â≠òÊ°£Êï∞ÊçÆ</p>
                            
                            <div class="save-manager">
                                <div class="save-manager-title">
                                    <i class="fas fa-database"></i> ÂΩìÂâçÂ≠òÊ°£‰ø°ÊÅØ
                                </div>
                                <div class="recycle-options">
                                    <div class="recycle-option">
                                        <div class="recycle-label">
                                            <i class="fas fa-clock"></i> ÊúÄÂêé‰øùÂ≠òÊó∂Èó¥
                                        </div>
                                        <div style="font-size: 0.9rem; color: #4682b4; text-align: center;" id="save-time">Êú™‰øùÂ≠ò</div>
                                    </div>
                                    
                                    <div class="recycle-option">
                                        <div class="recycle-label">
                                            <i class="fas fa-gamepad"></i> Ê∏∏ÊàèÁâàÊú¨
                                        </div>
                                        <div style="font-size: 0.9rem; color: #4682b4; text-align: center;" id="save-version">v4.3</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="save-manager">
                                <div class="save-manager-title">
                                    <i class="fas fa-copy"></i> Â§çÂà∂Â≠òÊ°£
                                </div>
                                <p style="font-size: 0.85rem; color: #666; margin-bottom: 8px;">Â∞ÜÂΩìÂâçÊ∏∏ÊàèËøõÂ∫¶Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø</p>
                                <button class="btn" id="copy-save-btn"><i class="fas fa-copy"></i> Â§çÂà∂Â≠òÊ°£Êï∞ÊçÆ</button>
                                <div style="margin-top: 8px; font-size: 0.75rem; color: #666; text-align: center;" id="copy-status"></div>
                            </div>
                            
                            <div class="save-manager">
                                <div class="save-manager-title">
                                    <i class="fas fa-paste"></i> Á≤òË¥¥Â≠òÊ°£
                                </div>
                                <p style="font-size: 0.85rem; color: #666; margin-bottom: 8px;">‰ªéÂâ™Ë¥¥ÊùøÁ≤òË¥¥Ê∏∏ÊàèËøõÂ∫¶</p>
                                <button class="btn" id="paste-save-btn"><i class="fas fa-paste"></i> Á≤òË¥¥Â≠òÊ°£Êï∞ÊçÆ</button>
                                <div style="margin-top: 8px; font-size: 0.75rem; color: #666; text-align: center;" id="paste-status"></div>
                            </div>
                            
                            <div class="action-buttons">
                                <button class="btn" id="quick-save-btn"><i class="fas fa-save"></i> Âø´ÈÄü‰øùÂ≠ò</button>
                                <button class="btn" id="load-last-btn"><i class="fas fa-folder-open"></i> Âä†ËΩΩ‰∏äÊ¨°Â≠òÊ°£</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Â±ûÊÄßÈù¢Êùø -->
                    <div class="panel" id="attribute-panel" style="display:none">
                        <h2 class="panel-title"><i class="fas fa-user"></i> ‰∫∫Áâ©Â±ûÊÄß</h2>
                        
                        <div class="character-stats">
                            <div class="stat-card">
                                <div class="stat-card-title">Â¢ÉÁïå</div>
                                <div class="stat-card-value" id="character-stage">ÁÇºÊ∞îÂàùÊúü</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-card-title">Á≠âÁ∫ß</div>
                                <div class="stat-card-value" id="character-level">1</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-card-title">ÁîüÂëΩÂÄº</div>
                                <div class="stat-card-value" id="character-hp">200/200</div>
                                <button class="stat-card-add" data-attr="hp">+</button>
                            </div>
                            <div class="stat-card">
                                <div class="stat-card-title">ÊîªÂáªÂäõ</div>
                                <div class="stat-card-value" id="character-attack">50</div>
                                <button class="stat-card-add" data-attr="attack">+</button>
                            </div>
                            <div class="stat-card">
                                <div class="stat-card-title">Èò≤Âæ°Âäõ</div>
                                <div class="stat-card-value" id="character-defense">20</div>
                                <button class="stat-card-add" data-attr="defense">+</button>
                            </div>
                            <div class="stat-card">
                                <div class="stat-card-title">Êö¥ÂáªÁéá</div>
                                <div class="stat-card-value" id="character-crit-rate">5%</div>
                                <button class="stat-card-add" data-attr="critRate">+</button>
                            </div>
                            <div class="stat-card">
                                <div class="stat-card-title">Êö¥Âáª‰º§ÂÆ≥</div>
                                <div class="stat-card-value" id="character-crit-dmg">150%</div>
                                <button class="stat-card-add" data-attr="critDmg">+</button>
                            </div>
                            <div class="stat-card">
                                <div class="stat-card-title">Èó™ÈÅøÁéá</div>
                                <div class="stat-card-value" id="character-dodge">5%</div>
                                <button class="stat-card-add" data-attr="dodge">+</button>
                            </div>
                            <div class="stat-card">
                                <div class="stat-card-title">‰ΩìË¥®</div>
                                <div class="stat-card-value" id="character-constitution">10</div>
                                <button class="stat-card-add" data-attr="constitution">+</button>
                            </div>
                        </div>
                        
                        <div style="margin: 12px 0; padding: 8px; background: rgba(212, 175, 55, 0.1); border-radius: 8px; font-size: 0.85rem; color: #666;">
                            <i class="fas fa-info-circle"></i> ‰ΩìË¥®ÊïàÊûú: ÊØèÁÇπ‰ΩìË¥®ÊèêÂçá1%ÂÖ®Â±ûÊÄß
                        </div>
                        
                        <!-- Ë£ÖÂ§áÂä†ÊàêÊòæÁ§∫ -->
                        <div class="gold-border">
                            <div class="attribute-title">
                                <i class="fas fa-gem gold-text"></i> Ë£ÖÂ§áÂä†Êàê
                            </div>
                            <div class="attribute-grid">
                                <div class="attribute-item">
                                    <div class="attribute-name">
                                        <span>Ê≠¶Âô®Âä†Êàê</span>
                                        <span class="attribute-value" id="equipment-attack-bonus">0</span>
                                    </div>
                                    <div class="attribute-cost">ÊîªÂáªÂäõÊèêÂçá</div>
                                </div>
                                <div class="attribute-item">
                                    <div class="attribute-name">
                                        <span>Êä§Áî≤Âä†Êàê</span>
                                        <span class="attribute-value" id="equipment-defense-bonus">0</span>
                                    </div>
                                    <div class="attribute-cost">Èò≤Âæ°ÂäõÊèêÂçá</div>
                                </div>
                                <div class="attribute-item">
                                    <div class="attribute-name">
                                        <span>ÁîüÂëΩÂä†Êàê</span>
                                        <span class="attribute-value" id="equipment-hp-bonus">0</span>
                                    </div>
                                    <div class="attribute-cost">ÁîüÂëΩÂÄºÊèêÂçá</div>
                                </div>
                                <div class="attribute-item">
                                    <div class="attribute-name">
                                        <span>Â•óË£ÖÊïàÊûú</span>
                                        <span class="attribute-value" id="set-bonus">Êó†</span>
                                    </div>
                                    <div class="attribute-cost">ÁâπÊÆäÊïàÊûú</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="gold-border">
                            <div class="attribute-title">
                                <i class="fas fa-plus-circle gold-text"></i> Â±ûÊÄßÂä†ÁÇπ
                                <span style="margin-left: auto;">ÂèØÁî®ÁÅµÂäõ: <span class="gold-text" id="available-spirit">0</span></span>
                            </div>
                            <div class="attribute-grid">
                                <div class="attribute-item">
                                    <div class="attribute-name">
                                        <span>ÊîªÂáªÂäõ</span>
                                        <span class="attribute-value" id="attack-value">50</span>
                                    </div>
                                    <div class="attribute-cost">Ê∂àËÄó: <span class="gold-text" id="attack-cost">100</span> ÁÅµÂäõ</div>
                                    <button class="attribute-add" data-attr="attack">ÊèêÂçá</button>
                                </div>
                                <div class="attribute-item">
                                    <div class="attribute-name">
                                        <span>Èò≤Âæ°Âäõ</span>
                                        <span class="attribute-value" id="defense-value">20</span>
                                    </div>
                                    <div class="attribute-cost">Ê∂àËÄó: <span class="gold-text" id="defense-cost">100</span> ÁÅµÂäõ</div>
                                    <button class="attribute-add" data-attr="defense">ÊèêÂçá</button>
                                </div>
                                <div class="attribute-item">
                                    <div class="attribute-name">
                                        <span>ÁîüÂëΩÂÄº</span>
                                        <span class="attribute-value" id="hp-value">200</span>
                                    </div>
                                    <div class="attribute-cost">Ê∂àËÄó: <span class="gold-text" id="hp-cost">100</span> ÁÅµÂäõ</div>
                                    <button class="attribute-add" data-attr="hp">ÊèêÂçá</button>
                                </div>
                                <div class="attribute-item">
                                    <div class="attribute-name">
                                        <span>‰ΩìË¥®</span>
                                        <span class="attribute-value" id="constitution-value">10</span>
                                    </div>
                                    <div class="attribute-cost">Ê∂àËÄó: <span class="gold-text" id="constitution-cost">200</span> ÁÅµÂäõ</div>
                                    <button class="attribute-add" data-attr="constitution">ÊèêÂçá</button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Â∑≤ÈÄâÂ§©ËµãÊòæÁ§∫ -->
                        <div class="selected-buffs-container">
                            <div class="selected-buffs-title">
                                <i class="fas fa-star"></i> Â∑≤ÈÄâÂ§©Ëµã
                            </div>
                            <div class="selected-buffs-grid" id="selected-buffs-grid">
                                <!-- Â∑≤ÈÄâÂ§©ËµãÂ∞ÜÂú®ËøôÈáåÊòæÁ§∫ -->
                            </div>
                        </div>
                        
                        <div class="special-attributes">
                            <div class="special-attribute">
                                <div class="special-name">Âê∏Ë°ÄÁéá</div>
                                <div class="special-value" id="character-lifeSteal">0%</div>
                            </div>
                            <div class="special-attribute">
                                <div class="special-name">ËøûÂáªÁéá</div>
                                <div class="special-value" id="character-combo">0%</div>
                            </div>
                            <div class="special-attribute">
                                <div class="special-name">‰øÆÁÇºÈÄüÂ∫¶</div>
                                <div class="special-value" id="character-cultivation-speed">100%</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="side-content">
                    <!-- ‰øÆ‰ªôÂ¢ÉÁïåÈù¢Êùø -->
                    <div class="panel">
                        <h2 class="panel-title"><i class="fas fa-fire"></i> ‰øÆ‰ªôÂ¢ÉÁïå
                            <span class="current-stage-display" id="current-stage-display">ÁÇºÊ∞îÂàùÊúü</span>
                        </h2>
                        <div class="spirit-power">
                            <span class="spirit-icon"></span> 
                            <div>
                                <div>ÁÅµÂäõ: <span id="spirit-power">0</span></div>
                                <div class="spirit-per-minute">ÊØè5ÁßíÊî∂Áõä: <span id="spirit-per-minute">0</span></div>
                            </div>
                        </div>
                        
                        <!-- Á≠âÁ∫ßËøõÂ∫¶ -->
                        <div class="progress-container">
                            <div class="progress-label">
                                <span>Á≠âÁ∫ßËøõÂ∫¶</span>
                                <span><span id="stage-progress-value">0</span>%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
                                <div class="progress-text" id="progress-text">Á≠âÁ∫ß 1 ¬∑ 0%</div>
                            </div>
                        </div>
                        
                        <!-- Â¢ÉÁïå‰øÆÁÇºËøõÂ∫¶ -->
                        <div class="cultivation-progress-container">
                            <div class="progress-label">
                                <span>Â¢ÉÁïå‰øÆÁÇºËøõÂ∫¶</span>
                                <span><span id="cultivation-progress-value">0</span>%</span>
                            </div>
                            <div class="cultivation-progress-bar">
                                <div class="cultivation-progress-fill" id="cultivation-progress-fill" style="width: 0%"></div>
                                <div class="cultivation-progress-text" id="cultivation-progress-text">ÁÇºÊ∞îÂàùÊúü ¬∑ 0%</div>
                            </div>
                        </div>
                        
                        <div class="action-buttons">
                            <button class="btn cultivate-btn" id="cultivate-btn"><i class="fas fa-meditation"></i> Èó≠ÂÖ≥‰øÆÁÇº</button>
                            <button class="btn" id="reset-game-btn-2" style="display:none"><i class="fas fa-redo"></i> ÈáçÁΩÆÊ∏∏Êàè</button>
                        </div>
                    </div>
                    
                    <!-- ÊàòÊñóÂå∫Âüü -->
                    <div class="panel monster-battle" id="monster-battle">
                        <h2 class="panel-title"><i class="fas fa-dragon"></i> Â¶ñÂÖΩÊåëÊàò</h2>
                        
                        <div class="monster-scroll" id="monster-selection">
                            <!-- Monster options will be generated here -->
                        </div>
                        
                        <div class="monster-name" id="monster-name">Ëµ§ÁÑ∞Â¶ñËôé</div>
                        <div class="monster-stats">
                            <div class="stat">
                                <div class="stat-value" id="monster-hp">400</div>
                                <div class="stat-label">Ê∞îË°Ä</div>
                            </div>
                            <div class="stat">
                                <div class="stat-value" id="monster-attack">40</div>
                                <div class="stat-label">ÊîªÂáª</div>
                            </div>
                            <div class="stat">
                                <div class="stat-value" id="monster-defense">10</div>
                                <div class="stat-label">Èò≤Âæ°</div>
                            </div>
                            <div class="stat">
                                <div class="stat-value" id="monster-cultivation">ÁÇºÊ∞î‰∏≠Êúü</div>
                                <div class="stat-label">‰øÆ‰∏∫</div>
                            </div>
                        </div>
                        
                        <div class="battle-status">
                            <div class="status-item">
                                <div class="status-label">‰Ω†ÁöÑÁîüÂëΩ</div>
                                <div class="status-value" id="player-hp-display">200/200</div>
                            </div>
                            <div class="status-item">
                                <div class="status-label">ÊÄ™Áâ©ÁîüÂëΩ</div>
                                <div class="status-value" id="monster-hp-display">400/400</div>
                            </div>
                        </div>
                        
                        <div class="battle-info" id="battle-info">
                            ÊàòÊñóÂ∞öÊú™ÂºÄÂßã...
                        </div>
                        
                        <div class="action-buttons">
                            <button class="btn battle-btn" data-action="attack" id="attack-btn"><i class="fas fa-fist-raised"></i> ÊîªÂáª</button>
                            <button class="btn auto-battle-btn" id="auto-battle-btn"><i class="fas fa-robot"></i> Ëá™Âä®ÊàòÊñó</button>
                        </div>
                        
                        <div class="resurrect-overlay" id="resurrect-overlay" style="display:none">
                            <div class="resurrect-title">ËßíËâ≤Â∑≤Èòµ‰∫°</div>
                            <div class="resurrect-timer">Â§çÊ¥ªÂÄíËÆ°Êó∂: <span id="resurrect-timer">5</span>Áßí</div>
                        </div>
                    </div>
                    
                    <!-- È°µËÑö‰ø°ÊÅØ -->
                    <div class="footer">
                        <p>‰øÆ‰ªôÊ®°ÊãüÂô® | ÂΩìÂâçÁâàÊú¨: 4.3 - Ë£ÖÂ§áÁ≥ªÁªü‰ºòÂåñÁâà</p>
                        <div class="cultivation-info">
                            <div class="info-item">
                                <i class="fas fa-bolt"></i> ÊØè5ÁßíÁÅµÂäõ: <span class="info-value" id="current-reward">0</span>
                            </div>
                            <div class="info-item">
                                <i class="fas fa-shield-alt"></i> ÂΩìÂâçÂ¢ÉÁïå: <span class="info-value" id="current-stage">ÁÇºÊ∞îÂàùÊúü</span>
                            </div>
                            <div class="info-item">
                                <i class="fas fa-dragon"></i> Â¶ñÂÖΩÂáªË¥•: <span class="info-value" id="monster-defeated">0</span>
                            </div>
                        </div>
                        <div class="cultivation-info" style="margin-top:8px">
                            <div class="info-item">
                                <i class="fas fa-clock"></i> Ê∏∏ÊàèÊó∂Èó¥: <span class="info-value" id="game-time">00:00:00</span>
                            </div>
                            <div class="info-item">
                                <i class="fas fa-save"></i> Ëá™Âä®‰øùÂ≠ò: <span class="info-value" id="last-save">--:--</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ÁßªÂä®Á´ØÂ∫ïÈÉ®ÂØºËà™ -->
    <div class="mobile-nav">
        <div class="nav-item active" data-target="talent-panel">
            <i class="fas fa-magic"></i>
            <span>Â§©Ëµã</span>
        </div>
        <div class="nav-item" data-target="attribute-panel">
            <i class="fas fa-user"></i>
            <span>Â±ûÊÄß</span>
        </div>
        <div class="nav-item" data-target="cultivate-btn">
            <i class="fas fa-meditation"></i>
            <span>‰øÆÁÇº</span>
        </div>
        <div class="nav-item" data-target="monster-battle">
            <i class="fas fa-dragon"></i>
            <span>Â¶ñÂÖΩ</span>
        </div>
        <div class="nav-item" data-target="equipment-content">
            <i class="fas fa-shield-alt"></i>
            <span>Ë£ÖÂ§á</span>
        </div>
    </div>

    <script>
        // ============================
        // Ê∏∏ÊàèÊï∞ÊçÆ‰∏éÁä∂ÊÄÅÁÆ°ÁêÜ
        // ============================
        const GameState = {
            VERSION: '4.3',
            
            // Âü∫Á°ÄËµÑÊ∫ê
            spiritPower: 0,
            refreshCount: 10,
            cultivationStage: 'ÁÇºÊ∞îÂàùÊúü',
            stageProgress: 0,
            cultivationProgress: 0,
            selectedBuffs: [],
            buffs: [],
            
            // ËßíËâ≤Â±ûÊÄß
            character: {
                baseHp: 200,
                baseAttack: 50,
                baseDefense: 20,
                baseCritRate: 5,
                baseCritDmg: 150,
                baseDodge: 5,
                baseLifeSteal: 0,
                baseCombo: 0,
                baseConstitution: 10,
                hp: 200,
                maxHp: 200,
                attack: 50,
                defense: 20,
                critRate: 5,
                critDmg: 150,
                dodge: 5,
                lifeSteal: 0,
                combo: 0,
                constitution: 10,
                isAlive: true,
                experience: 0,
                level: 1
            },
            
            // ÊÄ™Áâ©Êï∞ÊçÆ
            monster: {
                name: 'Ëµ§ÁÑ∞Â¶ñËôé',
                hp: 400,
                maxHp: 400,
                attack: 40,
                defense: 10,
                cultivation: 'ÁÇºÊ∞î‰∏≠Êúü',
                rewardMin: 30,
                rewardMax: 50,
                level: 1
            },
            
            // Â±ûÊÄßÂä†ÁÇπÊ∂àËÄó
            attributeCosts: {
                attack: 100,
                defense: 100,
                hp: 100,
                critRate: 200,
                critDmg: 200,
                dodge: 200,
                lifeSteal: 300,
                combo: 300,
                constitution: 200
            },
            
            // Ê∏∏ÊàèÁä∂ÊÄÅ
            cultivationInterval: null,
            inBattle: false,
            monsterDefeated: 0,
            stageReward: 10,
            autoBattleInterval: null,
            autoBattleActive: false,
            gameTime: 0, // Ê∏∏ÊàèÊó∂Èó¥ÔºàÁßíÔºâ
            lastSaveTime: null,
            
            // Ë£ÖÂ§áÁ≥ªÁªüÊï∞ÊçÆ - Êâ©Â±ïÂêéÁöÑË£ÖÂ§áÁ±ªÂûã
            equipment: {
                weapon: null,
                armor: null,
                hand: null,
                ring: null,
                necklace: null,
                shoe: null
            },
            inventory: [], // ËÉåÂåÖÁâ©ÂìÅ
            selectedInventoryItem: null, // ÈÄâ‰∏≠ÁöÑËÉåÂåÖÁâ©ÂìÅ
            
            // Ëá™Âä®ÂõûÊî∂ËÆæÁΩÆ
            autoRecycle: {
                enabled: true,
                levelThreshold: 5,
                rarityThreshold: 'common',
                totalRecycledSpirit: 0,
                totalRecycledItems: 0
            },
            
            // Ê∏∏ÊàèËÆæÁΩÆ
            settings: {
                autosaveEnabled: true,
                animationEnabled: true,
                saveInterval: 30000 // 30ÁßíËá™Âä®‰øùÂ≠ò
            }
        };
        
        // ============================
        // Ê∏∏ÊàèÂ∏∏Èáè
        // ============================
        const CULTIVATION_STAGES = [
            'ÁÇºÊ∞îÂàùÊúü', 'ÁÇºÊ∞î‰∏≠Êúü', 'ÁÇºÊ∞îÂêéÊúü',
            'Á≠ëÂü∫ÂàùÊúü', 'Á≠ëÂü∫‰∏≠Êúü', 'Á≠ëÂü∫ÂêéÊúü',
            'Èáë‰∏πÂàùÊúü', 'Èáë‰∏π‰∏≠Êúü', 'Èáë‰∏πÂêéÊúü',
            'ÂÖÉÂ©¥ÂàùÊúü', 'ÂÖÉÂ©¥‰∏≠Êúü', 'ÂÖÉÂ©¥ÂêéÊúü',
            'ÂåñÁ•ûÂàùÊúü', 'ÂåñÁ•û‰∏≠Êúü', 'ÂåñÁ•ûÂêéÊúü',
            'ÁÇºËôöÂàùÊúü', 'ÁÇºËôö‰∏≠Êúü', 'ÁÇºËôöÂêéÊúü',
            'ÂêàÈÅìÂàùÊúü', 'ÂêàÈÅì‰∏≠Êúü', 'ÂêàÈÅìÂêéÊúü',
            'Ê∏°Âä´ÂàùÊúü', 'Ê∏°Âä´‰∏≠Êúü', 'Ê∏°Âä´ÂêéÊúü',
            'È£ûÂçáÊúü'
        ];
        
        const MONSTERS_BY_LEVEL = {
            1: { name: 'Ëµ§ÁÑ∞Â¶ñËôé', hp: 400, maxHp: 400, attack: 40, defense: 10, cultivation: 'ÁÇºÊ∞î‰∏≠Êúü', rewardMin: 30, rewardMax: 50 },
            2: { name: 'ÂØíÂÜ∞Â∑®Ëüí', hp: 5000, maxHp: 5000, attack: 500, defense: 200, cultivation: 'Á≠ëÂü∫ÂàùÊúü', rewardMin: 60, rewardMax: 100 },
            3: { name: 'Èõ∑ÈúÜÈáëÈπè', hp: 12000, maxHp: 12000, attack: 1200, defense: 450, cultivation: 'Èáë‰∏πÂàùÊúü', rewardMin: 120, rewardMax: 180 },
            4: { name: 'ÁÜîÂ≤©Â∑®‰∫∫', hp: 35000, maxHp: 35000, attack: 3500, defense: 1000, cultivation: 'ÂÖÉÂ©¥ÂàùÊúü', rewardMin: 240, rewardMax: 360 },
            5: { name: '‰πùÂπΩËõüÈæô', hp: 200000, maxHp: 200000, attack: 15000, defense: 4000, cultivation: 'ÂåñÁ•ûÂàùÊúü', rewardMin: 480, rewardMax: 720 },
            6: { name: 'ÁéÑÂÜ∞Âá§Âá∞', hp: 500000, maxHp: 500000, attack: 54000, defense: 10000, cultivation: 'ÁÇºËôöÂàùÊúü', rewardMin: 960, rewardMax: 1440 },
            7: { name: 'Ê∑∑Ê≤åÁü≥ÁÅµ', hp: 1200000, maxHp: 1200000, attack: 130000, defense: 15000, cultivation: 'ÂêàÈÅìÂàùÊúü', rewardMin: 1920, rewardMax: 2880 },
            8: { name: '‰πùÂ§©Á•ûÈæô', hp: 2000000, maxHp: 2000000, attack: 300000, defense: 20000, cultivation: 'Ê∏°Âä´ÂàùÊúü', rewardMin: 3840, rewardMax: 5760 },
            9: { name: 'ËôöÁ©∫Â§©È≠î', hp: 5000000, maxHp: 5000000, attack: 500000, defense: 50000, cultivation: 'È£ûÂçáÊúü', rewardMin: 7680, rewardMax: 11520 }
        };
        
        // Ë£ÖÂ§áÁ±ªÂûãÂÆö‰πâ
        const EQUIPMENT_TYPES = [
            { id: 'weapon', name: 'Ê≠¶Âô®', icon: '‚öîÔ∏è' },
            { id: 'armor', name: 'Êä§Áî≤', icon: 'üõ°Ô∏è' },
            { id: 'hand', name: 'Êâã', icon: '‚úã' },
            { id: 'ring', name: 'ÊàíÊåá', icon: 'üíç' },
            { id: 'necklace', name: 'È°πÈìæ', icon: 'üìø' },
            { id: 'shoe', name: 'Èûã', icon: 'üëü' }
        ];
        
        // Ë£ÖÂ§áÁ®ÄÊúâÂ∫¶
        const EQUIPMENT_RARITIES = [
            { id: 'common', name: 'ÊôÆÈÄö', color: '#999', weight: 40, multiplier: 1.0 },
            { id: 'rare', name: 'Á®ÄÊúâ', color: '#4682b4', weight: 30, multiplier: 1.5 },
            { id: 'epic', name: 'Âè≤ËØó', color: '#9370db', weight: 20, multiplier: 2.0 },
            { id: 'legendary', name: '‰º†ËØ¥', color: '#daa520', weight: 10, multiplier: 3.0 }
        ];
        
        // Ë£ÖÂ§áÂ±ûÊÄßÊ±†
        const EQUIPMENT_STATS = {
            weapon: {
                primary: 'attack',
                possibleStats: ['attack', 'critRate', 'critDmg', 'lifeSteal']
            },
            armor: {
                primary: 'defense',
                possibleStats: ['defense', 'hp', 'dodge']
            },
            hand: {
                primary: 'critRate',
                possibleStats: ['critRate', 'attack', 'defense', 'combo']
            },
            ring: {
                primary: 'critDmg',
                possibleStats: ['critDmg', 'critRate', 'lifeSteal', 'attack']
            },
            necklace: {
                primary: 'hp',
                possibleStats: ['hp', 'lifeSteal', 'dodge', 'defense']
            },
            shoe: {
                primary: 'dodge',
                possibleStats: ['dodge', 'hp', 'defense', 'combo']
            }
        };
        
        // Ë£ÖÂ§áÂêçÁß∞ÂâçÁºÄÂíåÂêéÁºÄ
        const EQUIPMENT_PREFIXES = {
            common: ['ÊôÆÈÄöÁöÑ', 'Âπ≥Âá°ÁöÑ', 'Á≤óÁ≥ôÁöÑ', 'ÁÆÄÊòìÁöÑ'],
            rare: ['Á≤æËá¥ÁöÑ', '‰ºòË¥®ÁöÑ', 'ÂùöÂõ∫ÁöÑ', 'ÈîãÂà©ÁöÑ'],
            epic: ['Âº∫Â§ßÁöÑ', 'Á®ÄÊúâÁöÑ', 'ÁèçË¥µÁöÑ', 'Á•ûÁßòÁöÑ'],
            legendary: ['‰º†ËØ¥ÁöÑ', 'Á•ûËØùÁöÑ', '‰∏çÊúΩÁöÑ', 'Á•ûÂú£ÁöÑ']
        };
        
        const EQUIPMENT_SUFFIXES = {
            weapon: ['Ââë', 'ÂàÄ', 'Êñß', 'Êùñ', 'Âºì'],
            armor: ['Áî≤', 'Ë¢ç', 'Ë°£', 'Èì†', 'Êúç'],
            hand: ['ÊâãÂ•ó', 'Êä§Êâã', 'Êã≥Â•ó', 'ÊâãÁî≤'],
            ring: ['ÊàíÊåá', 'ÊåáÁéØ', 'Êàí'],
            necklace: ['È°πÈìæ', 'ÂêäÂù†', 'Êä§Á¨¶'],
            shoe: ['Èù¥', 'Èûã', 'Â±•', 'Ë∂≥ÂÖ∑']
        };
        
        // Â§©ËµãÊ±†
        const BUFF_POOL = [
            // ÊôÆÈÄöÂ§©Ëµã
            { id: 1, name: '‰ΩìÈ≠ÑÂº∫ÂÅ•', rarity: 'common', desc: 'Ê∞îË°Ä‰∏äÈôêÊèêÂçá10%', effect: "hp", value: 0.1 },
            { id: 2, name: 'ÁªèËÑâÈÄöÁïÖ', rarity: 'common', desc: 'ÁÅµÂäõÊÅ¢Â§çÈÄüÂ∫¶ÊèêÂçá15%', effect: "spiritGain", value: 0.15 },
            { id: 3, name: 'ÊÇüÊÄßÊèêÂçá', rarity: 'common', desc: '‰øÆÁÇºÈÄüÂ∫¶ÊèêÂçá10%', effect: "cultivationSpeed", value: 0.1 },
            { id: 4, name: 'Âü∫Á°ÄÂâëËØÄ', rarity: 'common', desc: 'ÊîªÂáªÂäõÊèêÂçá15%', effect: "attack", value: 0.15 },
            { id: 5, name: 'ÈìÅÈ™®ÈìÆÈìÆ', rarity: 'common', desc: 'Èò≤Âæ°ÂäõÊèêÂçá10%', effect: "defense", value: 0.1 },
            
            // Á®ÄÊúâÂ§©Ëµã
            { id: 10, name: '‰∫îË°åÁÅµÊ†π', rarity: 'rare', desc: 'ÂÖ®Â±ûÊÄßÊäóÊÄßÊèêÂçá20%', effect: "defense", value: 0.2 },
            { id: 11, name: 'Âæ°Âô®Á≤æÈÄö', rarity: 'rare', desc: 'ÊîªÂáªÂäõÊèêÂçá30%', effect: "attack", value: 0.3 },
            { id: 12, name: 'Á•ûËØÜÊïèÈîê', rarity: 'rare', desc: 'Èó™ÈÅøÁéáÊèêÂçá10%', effect: "dodge", value: 0.1 },
            { id: 13, name: 'ÂâëÊÑèÂàùÊàê', rarity: 'rare', desc: 'ÊîªÂáªÂäõÊèêÂçá35%', effect: "attack", value: 0.35 },
            
            // Âè≤ËØóÂ§©Ëµã
            { id: 17, name: '‰πùËΩ¨Èáë‰∏π', rarity: 'epic', desc: 'Á™ÅÁ†¥ÊàêÂäüÁéáÊèêÂçá50%ÔºåÁÅµÂäõ‰∏äÈôêÂ¢ûÂä†30%', effect: "cultivationSpeed", value: 0.5 },
            { id: 18, name: 'ÂâëÊÑèÂáõÁÑ∂', rarity: 'epic', desc: 'ÊîªÂáªÂäõÊèêÂçá70%ÔºåÊö¥ÂáªÁéáÂ¢ûÂä†15%', effect: "crit", value: 0.15 },
            { id: 19, name: 'Âá§Âá∞Ë°ÄËÑâ', rarity: 'epic', desc: 'Ê≠ª‰∫°Âêé30%Ê¶ÇÁéáÂ§çÊ¥ªÔºåÂÖ®Â±ûÊÄßÊèêÂçá25%', effect: "revive", value: 0.25 },
            { id: 20, name: 'Êó∂Èó¥Ê≥ïÂàô', rarity: 'epic', desc: 'ÊåÇÊú∫Êî∂ÁõäÊèêÂçá100%', effect: "spiritGain", value: 1.0 },
            
            // ‰º†ËØ¥Â§©Ëµã
            { id: 24, name: 'Ê∑∑Ê≤åÈÅì‰Ωì', rarity: 'legendary', desc: 'ÂÖ®Â±ûÊÄßÊèêÂçá50%Ôºå‰øÆÁÇºÊó†Áì∂È¢à', effect: "all", value: 0.5 },
            { id: 25, name: 'Â§©ÈÅìÁú∑È°æ', rarity: 'legendary', desc: 'Â•áÈÅáÊ¶ÇÁéáÊèêÂçá150%ÔºåËé∑ÂæóÁ®ÄÊúâÁâ©ÂìÅÊ¶ÇÁéáÁøªÂÄç', effect: "luck", value: 1.5 },
            { id: 26, name: '‰∏çÊúΩÈáëË∫´', rarity: 'legendary', desc: 'ÂÖçÁñ´‰∏ÄÂàáÊéßÂà∂ÔºåÂèóÂà∞‰º§ÂÆ≥Èôç‰Ωé50%', effect: "defense", value: 0.5 },
            { id: 27, name: '‰∏áÊ≥ïÂΩí‰∏Ä', rarity: 'legendary', desc: 'ÊâÄÊúâ‰º§ÂÆ≥ÊèêÂçá100%', effect: "attack", value: 1.0 }
        ];
        
        // Á®ÄÊúâÂ∫¶ÊùÉÈáç
        const RARITY_WEIGHTS = {
            'common': 40,
            'rare': 30,
            'epic': 20,
            'legendary': 10
        };
        
        // ============================
        // Ê†∏ÂøÉÊ∏∏ÊàèÂäüËÉΩ
        // ============================
        
        // ÂàùÂßãÂåñÊ∏∏Êàè
        function initGame() {
            showLoading(true);
            
            // Âä†ËΩΩ‰øùÂ≠òÁöÑÊ∏∏ÊàèÊï∞ÊçÆ
            loadGameData();
            
            // ÂàùÂßãÂåñÂ§©Ëµã
            refreshBuffs();
            
            // ÂàùÂßãÂåñÊÄ™Áâ©ÈÄâÈ°π
            initMonsterOptions();
            
            // ÂàùÂßãÂåñË£ÖÂ§áÁ≥ªÁªü
            initEquipment();
            
            // ÂàùÂßãÂåñËá™Âä®ÂõûÊî∂ËÆæÁΩÆ
            initAutoRecycle();
            
            // ÂºÄÂßãÊ∏∏ÊàèËÆ°Êó∂Âô®
            startGameTimer();
            
            // ÂºÄÂßãËá™Âä®‰øùÂ≠ò
            if (GameState.settings.autosaveEnabled) {
                startAutoSave();
            }
            
            // Êõ¥Êñ∞UI
            updateUI();
            
            // ÈöêËóèÂä†ËΩΩÁïåÈù¢
            setTimeout(() => {
                showLoading(false);
                showNotification('Ê¨¢ËøéÂΩíÊù•', '‰øÆ‰ªô‰πãË∑ØÁªßÁª≠ÔºåÁ•ùÈÅìÂèãÊó©Êó•ÂæóÈÅìÊàê‰ªôÔºÅ');
            }, 1000);
        }
        
        // ÊòæÁ§∫/ÈöêËóèÂä†ËΩΩÁïåÈù¢
        function showLoading(show) {
            document.getElementById('loading').style.display = show ? 'flex' : 'none';
        }
        
        // ÊòæÁ§∫ÈÄöÁü•
        function showNotification(title, content) {
            const notification = document.getElementById('notification');
            const notificationTitle = document.getElementById('notification-title');
            const notificationContent = document.getElementById('notification-content');
            
            notificationTitle.textContent = title;
            notificationContent.textContent = content;
            
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }
        
        // ËÆ°ÁÆóÂ±ûÊÄßÔºàÂåÖÂê´Ë£ÖÂ§áÂíåÂ§©ËµãÂä†ÊàêÔºâ
        function calculateAttributes() {
            // ÈáçÁΩÆ‰∏∫Âü∫Á°ÄÂ±ûÊÄß
            GameState.character.maxHp = GameState.character.baseHp;
            GameState.character.attack = GameState.character.baseAttack;
            GameState.character.defense = GameState.character.baseDefense;
            GameState.character.critRate = GameState.character.baseCritRate;
            GameState.character.critDmg = GameState.character.baseCritDmg;
            GameState.character.dodge = GameState.character.baseDodge;
            GameState.character.lifeSteal = GameState.character.baseLifeSteal;
            GameState.character.combo = GameState.character.baseCombo;
            GameState.character.constitution = GameState.character.baseConstitution;
            
            // Â∫îÁî®‰ΩìË¥®Âä†Êàê
            const constitutionMultiplier = 1 + (GameState.character.constitution * 0.01);
            
            GameState.character.maxHp *= constitutionMultiplier;
            GameState.character.attack *= constitutionMultiplier;
            GameState.character.defense *= constitutionMultiplier;
            GameState.character.critRate *= constitutionMultiplier;
            GameState.character.critDmg *= constitutionMultiplier;
            GameState.character.dodge *= constitutionMultiplier;
            GameState.character.lifeSteal *= constitutionMultiplier;
            GameState.character.combo *= constitutionMultiplier;
            
            // Â∫îÁî®Â§©ËµãÂä†Êàê
            GameState.selectedBuffs.forEach(buff => {
                applyBuffEffect(buff);
            });
            
            // Â∫îÁî®Ë£ÖÂ§áÂä†Êàê
            applyEquipmentEffects();
            
            // Á°Æ‰øùÂ±ûÊÄß‰∏çË∂ÖËøá‰∏äÈôê
            GameState.character.dodge = Math.min(GameState.character.dodge, 80);
            GameState.character.critRate = Math.min(GameState.character.critRate, 80);
            GameState.character.lifeSteal = Math.min(GameState.character.lifeSteal, 80);
            GameState.character.combo = Math.min(GameState.character.combo, 80);
            
            // Êõ¥Êñ∞ÂΩìÂâçÁîüÂëΩÂÄº
            GameState.character.hp = Math.min(GameState.character.hp, GameState.character.maxHp);
        }
        
        // Â∫îÁî®Â§©ËµãÊïàÊûú
        function applyBuffEffect(buff) {
            switch(buff.effect) {
                case "hp":
                    GameState.character.maxHp *= (1 + buff.value);
                    break;
                case "attack":
                    GameState.character.attack *= (1 + buff.value);
                    break;
                case "defense":
                    GameState.character.defense *= (1 + buff.value);
                    break;
                case "dodge":
                    GameState.character.dodge += buff.value * 100;
                    break;
                case "crit":
                    GameState.character.critRate += buff.value * 100;
                    break;
                case "lifeSteal":
                    GameState.character.lifeSteal += buff.value * 100;
                    break;
                case "combo":
                    GameState.character.combo += buff.value * 100;
                    break;
                case "all":
                    GameState.character.maxHp *= (1 + buff.value);
                    GameState.character.attack *= (1 + buff.value);
                    GameState.character.defense *= (1 + buff.value);
                    GameState.character.critRate += buff.value * 100;
                    GameState.character.critDmg += buff.value * 100;
                    GameState.character.dodge += buff.value * 100;
                    GameState.character.lifeSteal += buff.value * 100;
                    GameState.character.combo += buff.value * 100;
                    break;
                case "spiritGain":
                case "cultivationSpeed":
                case "revive":
                case "luck":
                    // Ëøô‰∫õÊïàÊûúÂú®Áõ∏ÂÖ≥ËÆ°ÁÆóÊó∂Â§ÑÁêÜ
                    break;
            }
        }
        
        // ============================
        // Ë£ÖÂ§áÁ≥ªÁªü - ‰ºòÂåñÁâà
        // ============================
        
        // ÂàùÂßãÂåñË£ÖÂ§áÁ≥ªÁªü
        function initEquipment() {
            // Êõ¥Êñ∞Ë£ÖÂ§áÊ†èÊòæÁ§∫
            updateEquipmentDisplay();
            
            // Êõ¥Êñ∞ËÉåÂåÖÊòæÁ§∫
            updateInventoryDisplay();
            
            // Ê∑ªÂä†ÂàùÂßãË£ÖÂ§áÂà∞ËÉåÂåÖ
            const initialWeapon = generateEquipment('weapon', 1, 'common');
            const initialArmor = generateEquipment('armor', 1, 'common');
            
            if (initialWeapon) addToInventory(initialWeapon);
            if (initialArmor) addToInventory(initialArmor);
            
            // Êõ¥Êñ∞UI
            updateInventoryDisplay();
        }
        
        // ÁîüÊàêÈöèÊú∫Ë£ÖÂ§á
        function generateEquipment(type, monsterLevel, forcedRarity = null) {
            // Á°ÆÂÆöË£ÖÂ§áÁ≠âÁ∫ßÔºöÊÄ™Áâ©Á≠âÁ∫ßË∂äÈ´òÔºåÈ´òÁ≠âÁ∫ßË£ÖÂ§áÊ¶ÇÁéáË∂äÈ´ò
            // ‰ΩÜ‰øùÊåÅÈöèÊú∫ÊÄßÔºåËÆ©‰ΩéÁ≠âÁ∫ß‰πüÊúâÊú∫‰ºöÂæóÂà∞È´òÁ≠âÁ∫ßË£ÖÂ§á
            const level = calculateEquipmentLevel(monsterLevel);
            
            // Á°ÆÂÆöÁ®ÄÊúâÂ∫¶ÔºöÊÄ™Áâ©Á≠âÁ∫ßË∂äÈ´òÔºåÈ´òÁ®ÄÊúâÂ∫¶Ê¶ÇÁéáË∂äÈ´ò
            // ‰ΩÜ‰ΩéÁ≠âÁ∫ßÊÄ™Áâ©‰πüÊúâÊûÅÂ∞èÊ¶ÇÁéáÊéâËêΩ‰º†Â•áË£ÖÂ§á
            const rarity = forcedRarity || calculateEquipmentRarity(monsterLevel);
            
            // Ëé∑ÂèñÁ®ÄÊúâÂ∫¶Êï∞ÊçÆ
            const rarityData = EQUIPMENT_RARITIES.find(r => r.id === rarity);
            if (!rarityData) return null;
            
            // Ëé∑ÂèñË£ÖÂ§áÁ±ªÂûãÊï∞ÊçÆ
            const typeData = EQUIPMENT_TYPES.find(t => t.id === type);
            if (!typeData) return null;
            
            // ÁîüÊàêË£ÖÂ§áÂêçÁß∞
            const prefix = EQUIPMENT_PREFIXES[rarity][Math.floor(Math.random() * EQUIPMENT_PREFIXES[rarity].length)];
            const suffix = EQUIPMENT_SUFFIXES[type][Math.floor(Math.random() * EQUIPMENT_SUFFIXES[type].length)];
            const name = `${prefix}${suffix}`;
            
            // ÁîüÊàêÂü∫Á°ÄÂ±ûÊÄßÔºàÂü∫‰∫éÁ≠âÁ∫ßÂíåÁ®ÄÊúâÂ∫¶Ôºâ
            const baseStats = generateBaseStats(type, level, rarityData.multiplier);
            
            // ÈöèÊú∫Ê∑ªÂä†ÈôÑÂä†Â±ûÊÄßÔºàÁ®ÄÊúâÂ∫¶Ë∂äÈ´òÔºåÈôÑÂä†Â±ûÊÄßË∂äÂ§öÔºâ
            const additionalStats = generateAdditionalStats(type, rarity);
            
            // ÂêàÂπ∂Â±ûÊÄß
            const stats = { ...baseStats, ...additionalStats };
            
            // ËÆ°ÁÆó‰ª∑Ê†º
            const price = calculateEquipmentPrice(stats, level, rarityData.multiplier);
            
            // ÁîüÊàêÊèèËø∞
            const desc = generateEquipmentDescription(name, type, level, rarity, stats);
            
            // ÂàõÂª∫Ë£ÖÂ§áÂØπË±°
            const equipment = {
                id: Date.now() + Math.floor(Math.random() * 1000),
                name: name,
                type: type,
                rarity: rarity,
                level: level,
                ...stats,
                price: price,
                desc: desc,
                icon: typeData.icon
            };
            
            return equipment;
        }
        
        // ËÆ°ÁÆóË£ÖÂ§áÁ≠âÁ∫ß
        function calculateEquipmentLevel(monsterLevel) {
            const MAX_LEVEL = 200;
    
            // Âü∫Á°ÄÊ¶ÇÁéáÂàÜÂ∏É
            const rand = Math.random();
    
            // Á°Æ‰øù‰ΩéÁ≠âÁ∫ßÊÄ™Áâ©‰πüÊúâÊú∫‰ºöÊéâËêΩ200Á∫ßË£ÖÂ§á
            // ÊûÅ‰ΩéÊ¶ÇÁéáÔºà0.5%ÔºâÁõ¥Êé•Ëé∑Âæó200Á∫ßË£ÖÂ§á
            if (rand < 0.005) { // 0.5%Ê¶ÇÁéá
                return MAX_LEVEL;
            }
    
            // ÈáçÊñ∞ËÆ°ÁÆóÊ¶ÇÁéáÔºàÊéíÈô§0.5%ÁöÑ‰º†Â•áÊ¶ÇÁéáÔºâ
            const adjustedRand = (rand - 0.005) / 0.995;
    
            if (adjustedRand < 0.6) {
                // 60%Ê¶ÇÁéáÔºöÊ≠£Â∏∏ËåÉÂõ¥ (ÊÄ™Áâ©Á≠âÁ∫ß¬±3)
                const min = Math.max(1, monsterLevel - 3);
                const max = Math.min(MAX_LEVEL, monsterLevel + 3);
                return min + Math.floor(Math.random() * (max - min + 1));
            } else if (adjustedRand < 0.9) {
                // 30%Ê¶ÇÁéáÔºöËæÉÂ•ΩËåÉÂõ¥ (ÊÄ™Áâ©Á≠âÁ∫ß+3Âà∞ÊÄ™Áâ©Á≠âÁ∫ß*2+10)
                const min = Math.min(MAX_LEVEL, monsterLevel + 3);
                const max = Math.min(MAX_LEVEL, monsterLevel * 2 + 10);
                return min + Math.floor(Math.random() * (max - min + 1));
            } else {
                // 9.5%Ê¶ÇÁéáÔºö‰º†Â•áËåÉÂõ¥
                // Á°Æ‰øùÊúâÊú∫‰ºöËææÂà∞200Á∫ß
                const min = Math.min(MAX_LEVEL, monsterLevel * 2 + 10);
                const max = MAX_LEVEL;
        
                // ‰ΩøÁî®ÊåáÊï∞ÂàÜÂ∏ÉÔºåÊõ¥ÂÄæÂêë‰∫éÈ´òÁ≠âÁ∫ß
                const exponentialFactor = Math.pow(Math.random(), 0.3); // ÊåáÊï∞ÂàÜÂ∏ÉÔºåÊõ¥ÂèØËÉΩÂæóÂà∞È´òÂÄº
                const levelRange = max - min + 1;
                const levelOffset = Math.floor(levelRange * exponentialFactor);
        
                return Math.min(MAX_LEVEL, min + levelOffset);
            }
        }
        
        // ËÆ°ÁÆóË£ÖÂ§áÁ®ÄÊúâÂ∫¶
        function calculateEquipmentRarity(monsterLevel) {
            // Âü∫Á°ÄÊ¶ÇÁéá
            let probabilities = {
                common: 0.5,
                rare: 0.3,
                epic: 0.15,
                legendary: 0.05
            };
            
            // Ê†πÊçÆÊÄ™Áâ©Á≠âÁ∫ßË∞ÉÊï¥Ê¶ÇÁéá
            // ÊÄ™Áâ©Á≠âÁ∫ßË∂äÈ´òÔºåÈ´òÁ®ÄÊúâÂ∫¶Ê¶ÇÁéáË∂äÈ´ò
            const levelFactor = Math.min(monsterLevel / 10, 1);
            
            probabilities.common = Math.max(0.1, 0.5 - levelFactor * 0.4);
            probabilities.rare = Math.min(0.4, 0.3 + levelFactor * 0.2);
            probabilities.epic = Math.min(0.3, 0.15 + levelFactor * 0.2);
            probabilities.legendary = Math.min(0.2, 0.05 + levelFactor * 0.15);
            
            // ‰ΩéÁ≠âÁ∫ßÊÄ™Áâ©‰πüÊúâÊûÅÂ∞èÊ¶ÇÁéáÊéâËêΩ‰º†Â•áË£ÖÂ§á
            if (monsterLevel <= 3) {
                probabilities.legendary = 0.01; // 1%Ê¶ÇÁéá
            }
            
            // ÂΩí‰∏ÄÂåñ
            const total = probabilities.common + probabilities.rare + probabilities.epic + probabilities.legendary;
            probabilities.common /= total;
            probabilities.rare /= total;
            probabilities.epic /= total;
            probabilities.legendary /= total;
            
            // ÈöèÊú∫ÈÄâÊã©Á®ÄÊúâÂ∫¶
            const rand = Math.random();
            let cumulative = 0;
            
            for (const rarity in probabilities) {
                cumulative += probabilities[rarity];
                if (rand <= cumulative) {
                    return rarity;
                }
            }
            
            return 'common';
        }
        
        // ÁîüÊàêÂü∫Á°ÄÂ±ûÊÄß
        function generateBaseStats(type, level, rarityMultiplier) {
            const stats = {};
            const typeData = EQUIPMENT_STATS[type];
            
            if (!typeData) return stats;
            
            // ‰∏ªÂ±ûÊÄß
            const primaryValue = Math.floor(level * 2 * rarityMultiplier);
            stats[typeData.primary] = primaryValue;
            
            // Ê†πÊçÆË£ÖÂ§áÁ±ªÂûãÊ∑ªÂä†È¢ùÂ§ñÂü∫Á°ÄÂ±ûÊÄß
            switch(type) {
                case 'weapon':
                    stats.attack = primaryValue;
                    break;
                case 'armor':
                    stats.defense = Math.floor(level * 1.5 * rarityMultiplier);
                    stats.hp = Math.floor(level * 10 * rarityMultiplier);
                    break;
                case 'hand':
                    stats.critRate = Math.floor(level * 0.5 * rarityMultiplier);
                    break;
                case 'ring':
                    stats.critDmg = Math.floor(level * 2 * rarityMultiplier);
                    break;
                case 'necklace':
                    stats.hp = Math.floor(level * 15 * rarityMultiplier);
                    break;
                case 'shoe':
                    stats.dodge = Math.floor(level * 0.5 * rarityMultiplier);
                    stats.hp = Math.floor(level * 5 * rarityMultiplier);
                    break;
            }
            
            return stats;
        }
        
        // ÁîüÊàêÈôÑÂä†Â±ûÊÄß
        function generateAdditionalStats(type, rarity) {
            const stats = {};
            const typeData = EQUIPMENT_STATS[type];
            
            if (!typeData) return stats;
            
            // Ê†πÊçÆÁ®ÄÊúâÂ∫¶ÂÜ≥ÂÆöÈôÑÂä†Â±ûÊÄßÊï∞Èáè
            let additionalCount = 0;
            switch(rarity) {
                case 'common':
                    additionalCount = 0; // ÊôÆÈÄöË£ÖÂ§áÊó†ÈôÑÂä†Â±ûÊÄß
                    break;
                case 'rare':
                    additionalCount = 1;
                    break;
                case 'epic':
                    additionalCount = 2;
                    break;
                case 'legendary':
                    additionalCount = 3;
                    break;
            }
            
            // ÂèØÈÄâÁöÑÂ±ûÊÄßÊ±†ÔºàÊéíÈô§‰∏ªÂ±ûÊÄßÔºâ
            const availableStats = typeData.possibleStats.filter(stat => stat !== typeData.primary);
            
            // ÈöèÊú∫ÈÄâÊã©ÈôÑÂä†Â±ûÊÄß
            for (let i = 0; i < additionalCount && availableStats.length > 0; i++) {
                const randomIndex = Math.floor(Math.random() * availableStats.length);
                const selectedStat = availableStats[randomIndex];
                
                // Ê†πÊçÆÂ±ûÊÄßÁ±ªÂûãÁîüÊàêÂÄº
                let value = 0;
                switch(selectedStat) {
                    case 'attack':
                    case 'defense':
                        value = Math.floor(5 + Math.random() * 10);
                        break;
                    case 'hp':
                        value = Math.floor(20 + Math.random() * 50);
                        break;
                    case 'critRate':
                    case 'dodge':
                    case 'lifeSteal':
                    case 'combo':
                        value = Math.floor(1 + Math.random() * 5);
                        break;
                    case 'critDmg':
                        value = Math.floor(5 + Math.random() * 15);
                        break;
                }
                
                // Á®ÄÊúâÂ∫¶Âä†Êàê
                const rarityMultiplier = EQUIPMENT_RARITIES.find(r => r.id === rarity).multiplier;
                value = Math.floor(value * rarityMultiplier);
                
                // Ê∑ªÂä†Âà∞Â±ûÊÄß
                stats[selectedStat] = (stats[selectedStat] || 0) + value;
                
                // ‰ªéÂèØÁî®Â±ûÊÄß‰∏≠ÁßªÈô§ÔºåÈÅøÂÖçÈáçÂ§ç
                availableStats.splice(randomIndex, 1);
            }
            
            return stats;
        }
        
        // ËÆ°ÁÆóË£ÖÂ§á‰ª∑Ê†º
        function calculateEquipmentPrice(stats, level, rarityMultiplier) {
            let price = 0;
            
            // Âü∫Á°Ä‰ª∑Ê†º
            price += level * 10 * rarityMultiplier;
            
            // Â±ûÊÄßÂä†Êàê
            for (const stat in stats) {
                let statValue = stats[stat];
                let statWeight = 1;
                
                switch(stat) {
                    case 'attack':
                    case 'defense':
                        statWeight = 2;
                        break;
                    case 'hp':
                        statWeight = 0.1;
                        break;
                    case 'critRate':
                    case 'dodge':
                    case 'lifeSteal':
                    case 'combo':
                        statWeight = 5;
                        break;
                    case 'critDmg':
                        statWeight = 3;
                        break;
                }
                
                price += statValue * statWeight * rarityMultiplier;
            }
            
            return Math.floor(price);
        }
        
        // ÁîüÊàêË£ÖÂ§áÊèèËø∞
        function generateEquipmentDescription(name, type, level, rarity, stats) {
            const rarityName = EQUIPMENT_RARITIES.find(r => r.id === rarity).name;
            const typeName = EQUIPMENT_TYPES.find(t => t.id === type).name;
            
            let desc = `‰∏Ä‰ª∂${rarityName}ÁöÑ${typeName}ÔºåÁ≠âÁ∫ß${level}„ÄÇ`;
            
            // Ê∑ªÂä†Â±ûÊÄßÊèèËø∞
            const statEntries = Object.entries(stats);
            if (statEntries.length > 0) {
                desc += ' Êã•Êúâ';
                statEntries.forEach(([stat, value], index) => {
                    const statName = getStatName(stat);
                    desc += ` ${statName}+${value}`;
                    if (index < statEntries.length - 1) desc += 'Ôºå';
                });
                desc += '„ÄÇ';
            }
            
            return desc;
        }
        
        // Ëé∑ÂèñÂ±ûÊÄßÂêçÁß∞
        function getStatName(stat) {
            const statNames = {
                attack: 'ÊîªÂáª',
                defense: 'Èò≤Âæ°',
                hp: 'ÁîüÂëΩ',
                critRate: 'Êö¥ÂáªÁéá',
                critDmg: 'Êö¥Âáª‰º§ÂÆ≥',
                dodge: 'Èó™ÈÅø',
                lifeSteal: 'Âê∏Ë°Ä',
                combo: 'ËøûÂáª'
            };
            
            return statNames[stat] || stat;
        }
        
        // Â∫îÁî®Ë£ÖÂ§áÊïàÊûú
        function applyEquipmentEffects() {
            let totalAttackBonus = 0;
            let totalDefenseBonus = 0;
            let totalHpBonus = 0;
            
            // Â∫îÁî®ÊâÄÊúâË£ÖÂ§áÁöÑÂ±ûÊÄß
            for (const slot in GameState.equipment) {
                const equipment = GameState.equipment[slot];
                if (equipment) {
                    // ÊîªÂáªÂ±ûÊÄß
                    if (equipment.attack) {
                        GameState.character.attack += equipment.attack;
                        totalAttackBonus += equipment.attack;
                    }
                    
                    // Èò≤Âæ°Â±ûÊÄß
                    if (equipment.defense) {
                        GameState.character.defense += equipment.defense;
                        totalDefenseBonus += equipment.defense;
                    }
                    
                    // ÁîüÂëΩÂ±ûÊÄß
                    if (equipment.hp) {
                        GameState.character.maxHp += equipment.hp;
                        totalHpBonus += equipment.hp;
                    }
                    
                    // Êö¥ÂáªÁéá
                    if (equipment.critRate) {
                        GameState.character.critRate += equipment.critRate;
                    }
                    
                    // Êö¥Âáª‰º§ÂÆ≥
                    if (equipment.critDmg) {
                        GameState.character.critDmg += equipment.critDmg;
                    }
                    
                    // Èó™ÈÅø
                    if (equipment.dodge) {
                        GameState.character.dodge += equipment.dodge;
                    }
                    
                    // Âê∏Ë°Ä
                    if (equipment.lifeSteal) {
                        GameState.character.lifeSteal += equipment.lifeSteal;
                    }
                    
                    // ËøûÂáª
                    if (equipment.combo) {
                        GameState.character.combo += equipment.combo;
                    }
                }
            }
            
            // Êõ¥Êñ∞Ë£ÖÂ§áÂä†ÊàêÊòæÁ§∫
            document.getElementById('total-attack-bonus').textContent = totalAttackBonus;
            document.getElementById('total-defense-bonus').textContent = totalDefenseBonus;
            document.getElementById('total-hp-bonus').textContent = totalHpBonus;
            
            document.getElementById('equipment-attack-bonus').textContent = totalAttackBonus;
            document.getElementById('equipment-defense-bonus').textContent = totalDefenseBonus;
            document.getElementById('equipment-hp-bonus').textContent = totalHpBonus;
            
            // Ê£ÄÊü•Â•óË£ÖÊïàÊûú
            checkSetBonus();
        }
        
        // Ê£ÄÊü•Â•óË£ÖÊïàÊûú
        function checkSetBonus() {
            // ÁªüËÆ°Âè≤ËØóÂíå‰º†ËØ¥Ë£ÖÂ§áÊï∞Èáè
            let epicCount = 0;
            let legendaryCount = 0;
            
            for (const slot in GameState.equipment) {
                const equipment = GameState.equipment[slot];
                if (equipment) {
                    if (equipment.rarity === 'epic') epicCount++;
                    if (equipment.rarity === 'legendary') legendaryCount++;
                }
            }
            
            let setBonus = 'Êó†';
            
            // ‰º†ËØ¥Â•óË£ÖÊïàÊûú
            if (legendaryCount >= 3) {
                // 3‰ª∂‰º†ËØ¥Ë£ÖÂ§áÔºöÂÖ®Â±ûÊÄß+20%
                GameState.character.attack *= 1.2;
                GameState.character.defense *= 1.2;
                GameState.character.maxHp *= 1.2;
                GameState.character.critRate *= 1.2;
                GameState.character.critDmg *= 1.2;
                GameState.character.dodge *= 1.2;
                setBonus = '‰º†ËØ¥Â•óË£Ö(+20%ÂÖ®Â±ûÊÄß)';
            } else if (epicCount >= 3) {
                // 3‰ª∂Âè≤ËØóË£ÖÂ§áÔºöÂÖ®Â±ûÊÄß+10%
                GameState.character.attack *= 1.1;
                GameState.character.defense *= 1.1;
                GameState.character.maxHp *= 1.1;
                setBonus = 'Âè≤ËØóÂ•óË£Ö(+10%ÂÖ®Â±ûÊÄß)';
            } else if (epicCount >= 2) {
                setBonus = '2‰ª∂Âè≤ËØóË£ÖÂ§á';
            } else if (legendaryCount >= 1) {
                setBonus = '1‰ª∂‰º†ËØ¥Ë£ÖÂ§á';
            }
            
            document.getElementById('set-bonus').textContent = setBonus;
        }
        
        // Êõ¥Êñ∞Ë£ÖÂ§áÊ†èÊòæÁ§∫
        function updateEquipmentDisplay() {
            const equipmentGrid = document.getElementById('equipment-grid');
            
            // Êõ¥Êñ∞ÊâÄÊúâË£ÖÂ§áÊßΩ
            for (const slotType in GameState.equipment) {
                const slotElement = equipmentGrid.querySelector(`[data-slot="${slotType}"]`);
                if (!slotElement) continue;
                
                const equipment = GameState.equipment[slotType];
                const typeData = EQUIPMENT_TYPES.find(t => t.id === slotType);
                
                if (equipment && typeData) {
                    slotElement.classList.add('filled');
                    
                    // Ëé∑Âèñ‰∏ªÂ±ûÊÄßÂÄº
                    let mainStat = '';
                    let mainValue = 0;
                    
                    if (equipment.attack) {
                        mainStat = 'Êîª';
                        mainValue = equipment.attack;
                    } else if (equipment.defense) {
                        mainStat = 'Èò≤';
                        mainValue = equipment.defense;
                    } else if (equipment.hp) {
                        mainStat = 'Áîü';
                        mainValue = equipment.hp;
                    } else if (equipment.critRate) {
                        mainStat = 'Êö¥';
                        mainValue = equipment.critRate;
                    }
                    
                    slotElement.innerHTML = `
                        <div class="equipment-icon">${equipment.icon || typeData.icon}</div>
                        <div class="equipment-name">${equipment.name}</div>
                        <div class="equipment-stats">${mainStat}+${mainValue}</div>
                        <div class="long-press-hint">ÈïøÊåâËÑ±‰∏ã</div>
                    `;
                } else {
                    slotElement.classList.remove('filled');
                    slotElement.innerHTML = `
                        <div class="equipment-icon">${typeData ? typeData.icon : 'üì¶'}</div>
                        <div class="equipment-name">${typeData ? typeData.name : 'Ë£ÖÂ§á'}</div>
                        <div class="equipment-stats">Êú™Ë£ÖÂ§á</div>
                        <div class="long-press-hint">ÈïøÊåâËÑ±‰∏ã</div>
                    `;
                }
            }
        }
        
        // Êõ¥Êñ∞ËÉåÂåÖÊòæÁ§∫
        function updateInventoryDisplay() {
            const inventoryGrid = document.getElementById('inventory-grid');
            const inventoryCount = document.getElementById('inventory-count');
            
            inventoryGrid.innerHTML = '';
            inventoryCount.textContent = GameState.inventory.length;
            
            // Êõ¥Êñ∞Âá∫ÂîÆÊåâÈíÆÁä∂ÊÄÅ
            const sellBtn = document.getElementById('sell-equipment-btn');
            
            if (GameState.selectedInventoryItem !== null) {
                sellBtn.disabled = false;
            } else {
                sellBtn.disabled = true;
            }
            
            // ÊòæÁ§∫ËÉåÂåÖÁâ©ÂìÅ
            GameState.inventory.forEach((item, index) => {
                const itemElement = document.createElement('div');
                itemElement.className = `inventory-item ${GameState.selectedInventoryItem === index ? 'selected' : ''}`;
                itemElement.dataset.index = index;
                
                // Ê†πÊçÆÁ®ÄÊúâÂ∫¶ËÆæÁΩÆÈ¢úËâ≤
                const rarityData = EQUIPMENT_RARITIES.find(r => r.id === item.rarity);
                const rarityColor = rarityData ? rarityData.color : '#999';
                
                // Ëé∑Âèñ‰∏ªÂ±ûÊÄß
                let mainStat = '';
                let mainValue = 0;
                
                if (item.attack) {
                    mainStat = 'Êîª';
                    mainValue = item.attack;
                } else if (item.defense) {
                    mainStat = 'Èò≤';
                    mainValue = item.defense;
                } else if (item.hp) {
                    mainStat = 'Áîü';
                    mainValue = item.hp;
                } else if (item.critRate) {
                    mainStat = 'Êö¥';
                    mainValue = item.critRate;
                }
                
                itemElement.innerHTML = `
                    <div class="item-rarity" style="background:${rarityColor}">${rarityData ? rarityData.name : 'ÊôÆÈÄö'}</div>
                    <div class="item-name">${item.name}</div>
                    <div class="item-stats">${mainStat}+${mainValue}</div>
                    <div class="item-type">${EQUIPMENT_TYPES.find(t => t.id === item.type)?.name || 'Ë£ÖÂ§á'}</div>
                    <div class="item-level">Lv.${item.level}</div>
                `;
                inventoryGrid.appendChild(itemElement);
            });
            
            // Â¶ÇÊûúËÉåÂåÖ‰∏∫Á©∫ÔºåÊòæÁ§∫ÊèêÁ§∫
            if (GameState.inventory.length === 0) {
                const emptyMessage = document.createElement('div');
                emptyMessage.style.textAlign = 'center';
                emptyMessage.style.color = '#999';
                emptyMessage.style.padding = '15px';
                emptyMessage.innerHTML = 'ËÉåÂåÖÁ©∫Á©∫Â¶Ç‰πü<br>ÂáªË¥•ÊÄ™Áâ©ÊúâÂá†ÁéáÊéâËêΩË£ÖÂ§á';
                inventoryGrid.appendChild(emptyMessage);
            }
        }
        
        // Ê∑ªÂä†Âà∞ËÉåÂåÖ
        function addToInventory(item) {
            if (GameState.inventory.length >= 30) {
                showNotification('ËÉåÂåÖÂ∑≤Êª°', 'ËÉåÂåÖÁ©∫Èó¥‰∏çË∂≥ÔºåÊó†Ê≥ïÊãæÂèñÊñ∞Ë£ÖÂ§áÔºÅ');
                return false;
            }
            
            // Ê£ÄÊü•ÊòØÂê¶Â∫îËØ•Ëá™Âä®ÂõûÊî∂
            if (shouldAutoRecycle(item)) {
                autoRecycleItem(item);
                return false;
            }
            
            // ÂàõÂª∫Ë£ÖÂ§áÂâØÊú¨
            const newItem = JSON.parse(JSON.stringify(item));
            GameState.inventory.push(newItem);
            
            // Êõ¥Êñ∞ËÉåÂåÖÊòæÁ§∫
            updateInventoryDisplay();
            
            return true;
        }
        
        // ‰ªéËÉåÂåÖÁßªÈô§Áâ©ÂìÅ
        function removeFromInventory(index) {
            if (index >= 0 && index < GameState.inventory.length) {
                GameState.inventory.splice(index, 1);
                
                // Â¶ÇÊûúÁßªÈô§ÁöÑÊòØÈÄâ‰∏≠ÁöÑÁâ©ÂìÅÔºåÊ∏ÖÁ©∫ÈÄâ‰∏≠Áä∂ÊÄÅ
                if (GameState.selectedInventoryItem === index) {
                    GameState.selectedInventoryItem = null;
                } else if (GameState.selectedInventoryItem > index) {
                    GameState.selectedInventoryItem--;
                }
                
                updateInventoryDisplay();
                return true;
            }
            return false;
        }
        
        // Á©øÊà¥Ë£ÖÂ§á
        function equipItem(itemIndex) {
            const item = GameState.inventory[itemIndex];
            if (!item) return;
            
            // Ê£ÄÊü•Á≠âÁ∫ßË¶ÅÊ±Ç
            if (item.level > GameState.character.level) {
                showNotification('Á©øÊà¥Â§±Ë¥•', `ÈúÄË¶ÅËææÂà∞${item.level}Á∫ßÊâçËÉΩÁ©øÊà¥Ê≠§Ë£ÖÂ§áÔºÅ`);
                return;
            }
            
            // ËÑ±‰∏ãÂΩìÂâçË£ÖÂ§áÔºàÂ¶ÇÊûúÊúâÔºâ
            let oldItem = null;
            oldItem = GameState.equipment[item.type];
            GameState.equipment[item.type] = item;
            
            // ÁßªÈô§ËÉåÂåÖ‰∏≠ÁöÑË£ÖÂ§á
            removeFromInventory(itemIndex);
            
            // Â¶ÇÊûúÊúâÊóßË£ÖÂ§áÔºåÊîæÂõûËÉåÂåÖ
            if (oldItem) {
                addToInventory(oldItem);
            }
            
            // ÈáçÊñ∞ËÆ°ÁÆóÂ±ûÊÄß
            calculateAttributes();
            
            showNotification('Ë£ÖÂ§áÁ©øÊà¥', `‰Ω†Á©ø‰∏ä‰∫Ü„Äê${item.name}„ÄëÔºÅ`);
            updateEquipmentDisplay();
            updateInventoryDisplay();
            updateUI();
        }
        
        // ËÑ±‰∏ãË£ÖÂ§á
        function unequipItem(slotType) {
            let item = GameState.equipment[slotType];
            GameState.equipment[slotType] = null;
            
            if (item) {
                // Â∞ÜË£ÖÂ§áÊîæÂõûËÉåÂåÖ
                if (addToInventory(item)) {
                    // ÈáçÊñ∞ËÆ°ÁÆóÂ±ûÊÄß
                    calculateAttributes();
                    
                    showNotification('Ë£ÖÂ§áËÑ±‰∏ã', `‰Ω†ËÑ±‰∏ã‰∫Ü„Äê${item.name}„ÄëÔºÅ`);
                    updateEquipmentDisplay();
                    updateInventoryDisplay();
                    updateUI();
                } else {
                    // ËÉåÂåÖÂ∑≤Êª°ÔºåÊÅ¢Â§çË£ÖÂ§á
                    GameState.equipment[slotType] = item;
                    showNotification('ËÑ±‰∏ãÂ§±Ë¥•', 'ËÉåÂåÖÂ∑≤Êª°ÔºåÊó†Ê≥ïËÑ±‰∏ãË£ÖÂ§áÔºÅ');
                }
            }
        }
        
        // Âá∫ÂîÆË£ÖÂ§á
        function sellSelectedEquipment() {
            if (GameState.selectedInventoryItem === null) return;
            
            const item = GameState.inventory[GameState.selectedInventoryItem];
            if (!item) return;
            
            const sellPrice = Math.floor(item.price * 0.7); // Âá∫ÂîÆ‰ª∑Ê†º‰∏∫Âéü‰ª∑ÁöÑ70%
            
            if (confirm(`Á°ÆÂÆöÂá∫ÂîÆ„Äê${item.name}„ÄëËé∑Âæó${sellPrice}ÁÇπÁÅµÂäõÂêóÔºü`)) {
                GameState.spiritPower += sellPrice;
                removeFromInventory(GameState.selectedInventoryItem);
                
                showNotification('Ë£ÖÂ§áÂá∫ÂîÆ', `Âá∫ÂîÆ„Äê${item.name}„ÄëËé∑Âæó${sellPrice}ÁÇπÁÅµÂäõÔºÅ`);
                updateUI();
            }
        }
        
        // ÊòæÁ§∫Ë£ÖÂ§áËØ¶ÊÉÖ
        function showEquipmentDetails(item) {
            const detailsPanel = document.getElementById('equipment-details');
            const detailsContent = document.getElementById('equipment-details-content');
            
            if (!item) {
                detailsPanel.classList.remove('show');
                return;
            }
            
            // Ëé∑ÂèñÁ®ÄÊúâÂ∫¶Êï∞ÊçÆ
            const rarityData = EQUIPMENT_RARITIES.find(r => r.id === item.rarity);
            const rarityColor = rarityData ? rarityData.color : '#999';
            const rarityName = rarityData ? rarityData.name : 'ÊôÆÈÄö';
            
            // ÁîüÊàêÂ±ûÊÄßHTML
            let statsHtml = '';
            if (item.attack) statsHtml += `<div>ÊîªÂáªÂäõ: +${item.attack}</div>`;
            if (item.defense) statsHtml += `<div>Èò≤Âæ°Âäõ: +${item.defense}</div>`;
            if (item.hp) statsHtml += `<div>ÁîüÂëΩÂÄº: +${item.hp}</div>`;
            if (item.critRate) statsHtml += `<div>Êö¥ÂáªÁéá: +${item.critRate}%</div>`;
            if (item.critDmg) statsHtml += `<div>Êö¥Âáª‰º§ÂÆ≥: +${item.critDmg}%</div>`;
            if (item.dodge) statsHtml += `<div>Èó™ÈÅøÁéá: +${item.dodge}%</div>`;
            if (item.lifeSteal) statsHtml += `<div>Âê∏Ë°ÄÁéá: +${item.lifeSteal}%</div>`;
            if (item.combo) statsHtml += `<div>ËøûÂáªÁéá: +${item.combo}%</div>`;
            
            detailsContent.innerHTML = `
                <div style="display: flex; align-items: center; margin-bottom: 8px;">
                    <div style="font-size: 1.8rem; margin-right: 8px;">${item.icon || 'üì¶'}</div>
                    <div>
                        <div style="font-size: 1.1rem; color: ${rarityColor}; font-weight: bold;">${item.name}</div>
                        <div style="color: ${rarityColor}; font-size: 0.85rem;">${rarityName} ¬∑ ${EQUIPMENT_TYPES.find(t => t.id === item.type)?.name || 'Ë£ÖÂ§á'}</div>
                    </div>
                </div>
                <div style="margin-bottom: 8px; color: #666;">${item.desc}</div>
                <div style="margin-bottom: 8px;">
                    <div style="color: #4682b4; font-weight: bold; margin-bottom: 4px;">Ë£ÖÂ§áÂ±ûÊÄß:</div>
                    ${statsHtml || '<div>Êó†ÈôÑÂä†Â±ûÊÄß</div>'}
                </div>
                <div style="display: flex; justify-content: space-between; color: #daa520;">
                    <div>Á≠âÁ∫ßË¶ÅÊ±Ç: ${item.level}</div>
                    <div>Âá∫ÂîÆ‰ª∑Ê†º: ${Math.floor(item.price * 0.7)}ÁÅµÂäõ</div>
                </div>
            `;
            
            detailsPanel.classList.add('show');
        }
        
        // ÂáªË¥•ÊÄ™Áâ©Êó∂ÊéâËêΩË£ÖÂ§á
        function dropEquipmentOnMonsterDefeat(monsterLevel) {
            // ÊéâËêΩÊ¶ÇÁéáÔºöÂü∫Á°Ä10% + ÊÄ™Áâ©Á≠âÁ∫ß*20%
            const dropChance = 0.1 + (monsterLevel * 0.2);
            
            if (Math.random() < dropChance) {
                // ÈöèÊú∫ÈÄâÊã©Ë£ÖÂ§áÁ±ªÂûã
                const randomTypeIndex = Math.floor(Math.random() * EQUIPMENT_TYPES.length);
                const equipmentType = EQUIPMENT_TYPES[randomTypeIndex].id;
                
                // ÁîüÊàêË£ÖÂ§á
                const equipment = generateEquipment(equipmentType, monsterLevel);
                
                if (equipment) {
                    // Ê∑ªÂä†Âà∞ËÉåÂåÖ
                    if (addToInventory(equipment)) {
                        return equipment;
                    }
                }
            }
            
            return null;
        }
        
        // ============================
        // Ëá™Âä®ÂõûÊî∂Á≥ªÁªü
        // ============================
        
        // ÂàùÂßãÂåñËá™Âä®ÂõûÊî∂ËÆæÁΩÆ
        function initAutoRecycle() {
            // ‰ªéÊú¨Âú∞Â≠òÂÇ®Âä†ËΩΩËÆæÁΩÆ
            const savedSettings = localStorage.getItem('cultivation_auto_recycle');
            if (savedSettings) {
                try {
                    GameState.autoRecycle = JSON.parse(savedSettings);
                } catch (e) {
                    console.error('Âä†ËΩΩËá™Âä®ÂõûÊî∂ËÆæÁΩÆÂ§±Ë¥•:', e);
                }
            }
            
            // Êõ¥Êñ∞UI
            updateAutoRecycleUI();
        }
        
        // Êõ¥Êñ∞Ëá™Âä®ÂõûÊî∂UI
        function updateAutoRecycleUI() {
            document.getElementById('recycle-level').value = GameState.autoRecycle.levelThreshold;
            document.getElementById('recycle-rarity').value = GameState.autoRecycle.rarityThreshold;
            document.getElementById('total-recycled-spirit').textContent = GameState.autoRecycle.totalRecycledSpirit;
            document.getElementById('total-recycled-items').textContent = GameState.autoRecycle.totalRecycledItems;
        }
        
        // Ê£ÄÊü•ÊòØÂê¶Â∫îËØ•Ëá™Âä®ÂõûÊî∂
        function shouldAutoRecycle(item) {
            // Ê£ÄÊü•Á≠âÁ∫ßÈòàÂÄº
            if (GameState.autoRecycle.levelThreshold > 0 && item.level < GameState.autoRecycle.levelThreshold) {
                return true;
            }
            
            // Ê£ÄÊü•Á®ÄÊúâÂ∫¶ÈòàÂÄº
            if (GameState.autoRecycle.rarityThreshold !== 'none') {
                const rarityOrder = ['common', 'rare', 'epic', 'legendary'];
                const itemRarityIndex = rarityOrder.indexOf(item.rarity);
                const thresholdRarityIndex = rarityOrder.indexOf(GameState.autoRecycle.rarityThreshold);
                
                if (itemRarityIndex < thresholdRarityIndex) {
                    return true;
                }
            }
            
            return false;
        }
        
        // Ëá™Âä®ÂõûÊî∂Ë£ÖÂ§á
        function autoRecycleItem(item) {
            const sellPrice = Math.floor(item.price * 0.7);
            GameState.spiritPower += sellPrice;
            GameState.autoRecycle.totalRecycledSpirit += sellPrice;
            GameState.autoRecycle.totalRecycledItems++;
            
            // ÊòæÁ§∫ÈÄöÁü•
            showNotification('Ëá™Âä®ÂõûÊî∂', `Ëá™Âä®ÂõûÊî∂„Äê${item.name}„ÄëËé∑Âæó${sellPrice}ÁÇπÁÅµÂäõÔºÅ`);
            
            // Êõ¥Êñ∞UI
            updateAutoRecycleUI();
            updateUI();
            
            return true;
        }
        
        // ÊâãÂä®ÂõûÊî∂ËÉåÂåÖ
        function manualRecycleBackpack() {
            let recycledCount = 0;
            let totalSpirit = 0;
            
            // ‰ªéÂêéÂæÄÂâçÈÅçÂéÜÔºåÈÅøÂÖçÁ¥¢ÂºïÈóÆÈ¢ò
            for (let i = GameState.inventory.length - 1; i >= 0; i--) {
                const item = GameState.inventory[i];
                
                // Ê£ÄÊü•ÊòØÂê¶Â∫îËØ•ÂõûÊî∂
                if (shouldAutoRecycle(item)) {
                    const sellPrice = Math.floor(item.price * 0.7);
                    totalSpirit += sellPrice;
                    recycledCount++;
                    
                    // ‰ªéËÉåÂåÖÁßªÈô§
                    removeFromInventory(i);
                }
            }
            
            if (recycledCount > 0) {
                GameState.spiritPower += totalSpirit;
                GameState.autoRecycle.totalRecycledSpirit += totalSpirit;
                GameState.autoRecycle.totalRecycledItems += recycledCount;
                
                showNotification('ËÉåÂåÖÂõûÊî∂', `ÂõûÊî∂‰∫Ü${recycledCount}‰ª∂Ë£ÖÂ§áÔºåËé∑Âæó${totalSpirit}ÁÇπÁÅµÂäõÔºÅ`);
                
                // Êõ¥Êñ∞UI
                updateAutoRecycleUI();
                updateUI();
            } else {
                showNotification('ËÉåÂåÖÂõûÊî∂', 'Ê≤°ÊúâÁ¨¶ÂêàÊù°‰ª∂ÁöÑË£ÖÂ§áÂèØ‰ª•ÂõûÊî∂ÔºÅ');
            }
        }
        
        // ‰øùÂ≠òËá™Âä®ÂõûÊî∂ËÆæÁΩÆ
        function saveAutoRecycleSettings() {
            // Ëé∑ÂèñÂΩìÂâçËÆæÁΩÆ
            GameState.autoRecycle.levelThreshold = parseInt(document.getElementById('recycle-level').value);
            GameState.autoRecycle.rarityThreshold = document.getElementById('recycle-rarity').value;
            
            // ‰øùÂ≠òÂà∞Êú¨Âú∞Â≠òÂÇ®
            try {
                localStorage.setItem('cultivation_auto_recycle', JSON.stringify(GameState.autoRecycle));
                showNotification('ËÆæÁΩÆ‰øùÂ≠ò', 'Ëá™Âä®ÂõûÊî∂ËÆæÁΩÆÂ∑≤‰øùÂ≠òÔºÅ');
            } catch (e) {
                showNotification('‰øùÂ≠òÂ§±Ë¥•', '‰øùÂ≠òËÆæÁΩÆÂ§±Ë¥•ÔºåËØ∑Ê£ÄÊü•ÊµèËßàÂô®ËÆæÁΩÆ');
            }
        }
        
        // ============================
        // Â§©ËµãÁ≥ªÁªü
        // ============================
        
        // Âà∑Êñ∞Â§©Ëµã
        function refreshBuffs() {
            if (GameState.refreshCount <= 0) {
                showNotification('Âà∑Êñ∞Â§±Ë¥•', 'Âà∑Êñ∞Ê¨°Êï∞Â∑≤Áî®ÂÆåÔºÅ');
                return;
            }
            
            GameState.refreshCount--;
            
            // ‰øùÁïôÈîÅÂÆöÁöÑÂ§©Ëµã
            const lockedBuffs = GameState.buffs.filter(buff => buff.locked);
            
            // ËÆ°ÁÆóÈúÄË¶ÅÂà∑Êñ∞ÁöÑÊï∞Èáè
            const refreshCount = 9 - lockedBuffs.length;
            
            // Ëé∑ÂèñÂΩìÂâçÂ∑≤Â≠òÂú®Â§©ËµãÁöÑIDÔºàÂåÖÊã¨ÈîÅÂÆöÁöÑÂíåÈÄâ‰∏≠ÁöÑÔºâ
            const existingBuffIds = new Set();
            lockedBuffs.forEach(buff => existingBuffIds.add(buff.id));
            GameState.selectedBuffs.forEach(buff => existingBuffIds.add(buff.id));
            
            // ÈöèÊú∫ÈÄâÊã©Êñ∞BUFFÔºàÊåâÊùÉÈáçÔºâÔºåÁ°Æ‰øù‰∏çÈáçÂ§ç
            const newBuffs = [...lockedBuffs];
            for (let i = 0; i < refreshCount; i++) {
                const rand = Math.random() * 100;
                let rarity;
                
                if (rand < RARITY_WEIGHTS.legendary) rarity = 'legendary';
                else if (rand < RARITY_WEIGHTS.legendary + RARITY_WEIGHTS.epic) rarity = 'epic';
                else if (rand < RARITY_WEIGHTS.legendary + RARITY_WEIGHTS.epic + RARITY_WEIGHTS.rare) rarity = 'rare';
                else rarity = 'common';
                
                // Á≠õÈÄâËØ•Á®ÄÊúâÂ∫¶‰∏î‰∏çÂú®Áé∞ÊúâÂ§©Ëµã‰∏≠ÁöÑBUFF
                const availableBuffs = BUFF_POOL.filter(buff => 
                    buff.rarity === rarity && !existingBuffIds.has(buff.id)
                );
                
                // Â¶ÇÊûúËØ•Á®ÄÊúâÂ∫¶Ê≤°ÊúâÂèØÁî®Â§©ËµãÔºåÈÄâÊã©‰ªªÊÑèÁ®ÄÊúâÂ∫¶‰ΩÜ‰∏çÂú®Áé∞ÊúâÂ§©Ëµã‰∏≠ÁöÑBUFF
                if (availableBuffs.length === 0) {
                    const fallbackBuffs = BUFF_POOL.filter(buff => !existingBuffIds.has(buff.id));
                    if (fallbackBuffs.length > 0) {
                        const randomBuff = {...fallbackBuffs[Math.floor(Math.random() * fallbackBuffs.length)]};
                        randomBuff.selected = GameState.selectedBuffs.some(b => b.id === randomBuff.id);
                        randomBuff.locked = false;
                        newBuffs.push(randomBuff);
                        existingBuffIds.add(randomBuff.id);
                    }
                } else {
                    const randomBuff = {...availableBuffs[Math.floor(Math.random() * availableBuffs.length)]};
                    randomBuff.selected = GameState.selectedBuffs.some(b => b.id === randomBuff.id);
                    randomBuff.locked = false;
                    newBuffs.push(randomBuff);
                    existingBuffIds.add(randomBuff.id);
                }
            }
            
            GameState.buffs = newBuffs;
            updateBuffsDisplay();
            updateUI();
            
            // Êõ¥Êñ∞ÂºÄÂßãÊåâÈíÆÁä∂ÊÄÅ
            document.getElementById('start-btn').disabled = GameState.selectedBuffs.length < 2;
        }
        
        // ÈÄâÊã©/ÂèñÊ∂àÈÄâÊã©Â§©Ëµã
        function toggleBuffSelection(buffIndex) {
            const buff = GameState.buffs[buffIndex];
            if (!buff) return;
            
            // ÂàáÊç¢ÈÄâÊã©Áä∂ÊÄÅ
            buff.selected = !buff.selected;
            
            if (buff.selected) {
                // Ê∑ªÂä†Âà∞Â∑≤ÈÄâ
                if (GameState.selectedBuffs.length < 2) {
                    // Á°Æ‰øùÂêå‰∏Ä‰∏™Â§©Ëµã‰∏ç‰ºöÈáçÂ§çÈÄâÊã©
                    if (!GameState.selectedBuffs.some(b => b.id === buff.id)) {
                        GameState.selectedBuffs.push(buff);
                    }
                } else {
                    // Â¶ÇÊûúÂ∑≤ÈÄâ‰∏§‰∏™ÔºåÂèñÊ∂àÈÄâÊã©
                    buff.selected = false;
                    showNotification('ÈÄâÊã©ÈôêÂà∂', 'ÊúÄÂ§öÂè™ËÉΩÈÄâÊã©‰∏§‰∏™Â§©Ëµã');
                    return;
                }
            } else {
                // ‰ªéÂ∑≤ÈÄâ‰∏≠ÁßªÈô§
                const buffIndexInSelected = GameState.selectedBuffs.findIndex(b => b.id === buff.id);
                if (buffIndexInSelected !== -1) {
                    GameState.selectedBuffs.splice(buffIndexInSelected, 1);
                }
            }
            
            // Êõ¥Êñ∞ÊòæÁ§∫
            updateBuffsDisplay();
            
            // Êõ¥Êñ∞ÂºÄÂßãÊåâÈíÆÁä∂ÊÄÅ
            document.getElementById('start-btn').disabled = GameState.selectedBuffs.length < 2;
        }
        
        // ÈîÅÂÆö/Ëß£ÈîÅÂ§©Ëµã
        function toggleBuffLock(buffIndex) {
            const buff = GameState.buffs[buffIndex];
            if (!buff) return;
            
            buff.locked = !buff.locked;
            
            // Êõ¥Êñ∞ÊòæÁ§∫
            updateBuffsDisplay();
        }
        
        // Ëé∑ÂèñÁ®ÄÊúâÂ∫¶ÂêçÁß∞
        function getRarityName(rarity) {
            switch(rarity) {
                case 'common': return 'ÊôÆÈÄö';
                case 'rare': return 'Á®ÄÊúâ';
                case 'epic': return 'Âè≤ËØó';
                case 'legendary': return '‰º†ËØ¥';
                case 'mythic': return 'Á•ûËØù';
                default: return 'Êú™Áü•';
            }
        }
        
        // Êõ¥Êñ∞Â§©ËµãÊòæÁ§∫
        function updateBuffsDisplay() {
            const buffContainer = document.getElementById('buff-container');
            buffContainer.innerHTML = '';
            
            GameState.buffs.forEach((buff, index) => {
                const buffElement = document.createElement('div');
                buffElement.className = `buff-card ${buff.rarity} ${buff.selected ? 'selected' : ''}`;
                buffElement.dataset.index = index;
                buffElement.innerHTML = `
                    <div class="lock-icon ${buff.locked ? 'locked' : ''}"><i class="fas ${buff.locked ? 'fa-lock' : 'fa-lock-open'}"></i></div>
                    <div class="buff-rarity">${getRarityName(buff.rarity)}</div>
                    <div class="buff-name">${buff.name}</div>
                    <div class="buff-desc">${buff.desc}</div>
                    <div class="buff-select">Â∑≤ÈÄâÊã©</div>
                `;
                buffContainer.appendChild(buffElement);
            });
            
            // Êõ¥Êñ∞Â∑≤ÈÄâÂ§©ËµãÊòæÁ§∫
            updateSelectedBuffsDisplay();
        }
        
        // Êõ¥Êñ∞Â∑≤ÈÄâÂ§©ËµãÊòæÁ§∫
        function updateSelectedBuffsDisplay() {
            const selectedBuffsGrid = document.getElementById('selected-buffs-grid');
            selectedBuffsGrid.innerHTML = '';
            
            GameState.selectedBuffs.forEach((buff, index) => {
                const buffElement = document.createElement('div');
                buffElement.className = `buff-card ${buff.rarity} selected`;
                buffElement.innerHTML = `
                    <div class="buff-rarity">${getRarityName(buff.rarity)}</div>
                    <div class="buff-name">${buff.name}</div>
                    <div class="buff-desc">${buff.desc}</div>
                `;
                selectedBuffsGrid.appendChild(buffElement);
            });
            
            // Êõ¥Êñ∞Â∑≤ÈÄâÂ§©ËµãÊï∞Èáè
            document.getElementById('selected-buffs-count').textContent = GameState.selectedBuffs.length;
        }
        
        // ============================
        // ÊàòÊñóÁ≥ªÁªü
        // ============================
        
        // Â§ÑÁêÜÊàòÊñóÂä®‰Ωú
        function handleBattleAction(action) {
            if (!GameState.character.isAlive) return;
            
            switch(action) {
                case 'attack':
                    performAttack();
                    break;
            }
        }
        
        // ÊâßË°åÊîªÂáª
        function performAttack() {
            let totalDamage = 0;
            let comboCount = 1;
            
            // Ê£ÄÊü•ËøûÂáª
            if (Math.random() < (GameState.character.combo / 100)) {
                comboCount = 2 + Math.floor(Math.random() * 3);
                updateBattleInfo(`Ëß¶ÂèëËøûÂáªÔºÅÂ∞ÜËøõË°å${comboCount}Ê¨°ÊîªÂáªÔºÅ`);
            }
            
            for (let i = 0; i < comboCount; i++) {
                // ËÆ°ÁÆóÊö¥Âáª
                let isCrit = Math.random() < (GameState.character.critRate / 100);
                let critMultiplier = isCrit ? GameState.character.critDmg / 100 : 1;
                
                const playerDamage = Math.floor(
                    GameState.character.attack * (0.8 + Math.random() * 0.4) * critMultiplier
                );
                
                GameState.monster.hp -= playerDamage;
                totalDamage += playerDamage;
                
                if (GameState.monster.hp < 0) GameState.monster.hp = 0;
                
                let logMessage = '';
                if (isCrit) {
                    logMessage = `Á¨¨${i+1}ÂáªÊö¥ÂáªÔºÅÈÄ†Êàê ${playerDamage} ÁÇπ‰º§ÂÆ≥ÔºÅ`;
                    // ÂàõÂª∫Êö¥ÂáªÂä®ÁîªÂÖÉÁ¥†
                    if (GameState.settings.animationEnabled) {
                        const critElement = document.createElement('div');
                        critElement.className = 'crit-text';
                        critElement.textContent = `Êö¥ÂáªÔºÅ${playerDamage}`;
                        critElement.style.position = 'absolute';
                        critElement.style.top = '50%';
                        critElement.style.left = '50%';
                        critElement.style.transform = 'translate(-50%, -50%)';
                        critElement.style.fontSize = '20px';
                        critElement.style.zIndex = '100';
                        critElement.style.animation = 'critAnimation 0.5s ease-in-out';
                        
                        document.querySelector('.monster-battle').appendChild(critElement);
                        
                        setTimeout(() => {
                            critElement.remove();
                        }, 1000);
                    }
                } else {
                    logMessage = `Á¨¨${i+1}ÂáªÈÄ†Êàê ${playerDamage} ÁÇπ‰º§ÂÆ≥ÔºÅ`;
                }
                
                updateBattleInfo(logMessage);
                
                // Âê∏Ë°ÄÊïàÊûú
                if (GameState.character.lifeSteal > 0) {
                    const healAmount = Math.floor(playerDamage * (GameState.character.lifeSteal / 100));
                    GameState.character.hp = Math.min(GameState.character.hp + healAmount, GameState.character.maxHp);
                    updateBattleInfo(`Âê∏Ë°ÄÊïàÊûúÊÅ¢Â§ç ${healAmount} ÁÇπÁîüÂëΩÂÄºÔºÅ`);
                }
                
                // Â¶ÇÊûúÊÄ™Áâ©Ê≠ª‰∫°ÔºåË∑≥Âá∫Âæ™ÁéØ
                if (GameState.monster.hp <= 0) {
                    break;
                }
            }
            
            setTimeout(() => {
                if (GameState.monster.hp <= 0) {
                    defeatMonster();
                } else {
                    const isDodge = Math.random() < (GameState.character.dodge / 100);
                    
                    if (isDodge) {
                        updateBattleInfo(`${GameState.monster.name}ÂèëÂä®ÊîªÂáªÔºå‰ΩÜ‰Ω†ÊàêÂäüÈó™ÈÅø‰∫ÜÔºÅ`);
                    } else {
                        // ‰º§ÂÆ≥ËÆ°ÁÆóÂÖ¨Âºè
                        let monsterDamage = Math.floor(
                            GameState.monster.attack - 1.33 * GameState.character.defense
                        );
                        
                        // Â¶ÇÊûú‰º§ÂÆ≥Â∞è‰∫é1ÔºåÂàôÂº∫Âà∂‰∏∫1
                        if (monsterDamage < 1) monsterDamage = 1;
                        
                        GameState.character.hp -= monsterDamage;
                        
                        if (GameState.character.hp <= 0) {
                            GameState.character.hp = 0;
                            GameState.character.isAlive = false;
                            updateBattleInfo(`${GameState.monster.name}ÂèëÂä®Ëá¥ÂëΩ‰∏ÄÂáªÔºå‰Ω†Â∑≤Èòµ‰∫°ÔºÅ`);
                            startResurrection();
                        } else {
                            updateBattleInfo(`${GameState.monster.name}ÂèëÂä®ÊîªÂáªÔºåÂØπ‰Ω†ÈÄ†Êàê ${monsterDamage} ÁÇπ‰º§ÂÆ≥ÔºÅ`);
                            updateBattleInfo(`${GameState.monster.name}Ê∞îË°ÄÂâ©‰Ωô ${GameState.monster.hp}/${GameState.monster.maxHp}`);
                        }
                    }
                }
                updateUI();
            }, 800);
        }
        
        // Êõ¥Êñ∞ÊàòÊñó‰ø°ÊÅØ
        function updateBattleInfo(message) {
            const battleInfo = document.getElementById('battle-info');
            battleInfo.innerHTML = `<div style="color: #4682b4; font-weight: bold;">${message}</div>`;
        }
        
        // ÂáªË¥•ÊÄ™Áâ©
        function defeatMonster() {
            const spiritReward = Math.floor(
                GameState.monster.rewardMin + 
                Math.random() * (GameState.monster.rewardMax - GameState.monster.rewardMin)
            );
            GameState.spiritPower += spiritReward;
            GameState.monsterDefeated++;
            
            // ÁªèÈ™åÂÄº
            GameState.character.experience += 10 * GameState.monster.level;
            checkLevelUp();
            
            updateBattleInfo(`${GameState.monster.name}Â∑≤Ë¢´ÂáªË¥•ÔºÅËé∑Âæó ${spiritReward} ÁÇπÁÅµÂäõ`);
            
            // ÈöèÊú∫ÊéâËêΩË£ÖÂ§á
            const droppedEquipment = dropEquipmentOnMonsterDefeat(GameState.monster.level);
            if (droppedEquipment) {
                updateBattleInfo(`${GameState.monster.name}ÊéâËêΩ‰∫Ü„Äê${droppedEquipment.name}„ÄëÔºÅ`);
            }
            
            setTimeout(() => {
                loadMonster(GameState.monster.level);
                updateBattleInfo(`Êñ∞ÁöÑ${GameState.monster.name}Âá∫Áé∞‰∫ÜÔºÅ`);
                updateUI();
            }, 1000);
        }
        
        // Ê£ÄÊü•ÂçáÁ∫ß
        function checkLevelUp() {
            const requiredExp = GameState.character.level * 100;
            if (GameState.character.experience >= requiredExp) {
                GameState.character.level++;
                GameState.character.experience -= requiredExp;
                
                // ÂçáÁ∫ßÂ•ñÂä±
                GameState.character.baseHp += 50;
                GameState.character.baseAttack += 20;
                GameState.character.baseDefense += 10;
                
                calculateAttributes();
                
                showNotification('Á≠âÁ∫ßÊèêÂçá', `ÊÅ≠ÂñúÂçáÂà∞${GameState.character.level}Á∫ßÔºÅÂÖ®Â±ûÊÄßÊèêÂçáÔºÅ`);
                updateUI();
            }
        }
        
        // ============================
        // ‰øÆ‰ªôÁ≥ªÁªü
        // ============================
        
        // ÂºÄÂßã‰øÆÁÇº
        function startCultivation() {
            // Ê∏ÖÈô§‰πãÂâçÁöÑÂÆöÊó∂Âô®
            if (GameState.cultivationInterval) {
                clearInterval(GameState.cultivationInterval);
            }
            
            // ÊØè5ÁßíÂ¢ûÂä†ÁÅµÂäõ
            GameState.cultivationInterval = setInterval(() => {
                // ËÆ°ÁÆóÂ¢ÉÁïåÂä†Êàê
                const stageMultiplier = 1 + (CULTIVATION_STAGES.indexOf(GameState.cultivationStage) * 0.3);
                
                // ËÆ°ÁÆóÂ§©ËµãÂä†Êàê
                let rewardMultiplier = 1;
                GameState.selectedBuffs.forEach(buff => {
                    if (buff.effect === "spiritGain") {
                        rewardMultiplier += buff.value;
                    }
                });
                
                const actualReward = Math.round(GameState.stageReward * stageMultiplier * rewardMultiplier);
                GameState.spiritPower += actualReward;
                
                updateUI();
            }, 5000);
        }
        
        // Èó≠ÂÖ≥‰øÆÁÇº
        function handleCultivation() {
            // ËÆ°ÁÆó‰øÆÁÇºÊ∂àËÄóÔºàÂ¢ÉÁïåË∂äÈ´òÊ∂àËÄóË∂äÂ§öÔºâ
            const stageIndex = CULTIVATION_STAGES.indexOf(GameState.cultivationStage);
            const cultivationCost = Math.floor(100 * Math.pow(1.2, stageIndex));
            
            if (GameState.spiritPower < cultivationCost) {
                showNotification('‰øÆÁÇºÂ§±Ë¥•', `ÁÅµÂäõ‰∏çË∂≥ÔºåÈúÄË¶ÅËá≥Â∞ë${cultivationCost}ÁÇπÁÅµÂäõËøõË°åÈó≠ÂÖ≥ÔºÅ`);
                return;
            }
            
            GameState.spiritPower -= cultivationCost;
            
            // ËÆ°ÁÆó‰øÆÁÇºÈÄüÂ∫¶Âä†Êàê
            let cultivationSpeed = 1;
            GameState.selectedBuffs.forEach(buff => {
                if (buff.effect === "cultivationSpeed") {
                    cultivationSpeed += buff.value;
                }
            });
            
            // Â¢ûÂä†‰øÆÁÇºËøõÂ∫¶
            const progressGain = Math.floor((5 + Math.floor(Math.random() * 10)) * cultivationSpeed);
            GameState.cultivationProgress += progressGain;
            
            if (GameState.cultivationProgress >= 100) {
                // ËøõÈò∂Âà∞‰∏ã‰∏ÄÂ¢ÉÁïå
                const currentIndex = CULTIVATION_STAGES.indexOf(GameState.cultivationStage);
                
                if (currentIndex < CULTIVATION_STAGES.length - 1) {
                    GameState.cultivationStage = CULTIVATION_STAGES[currentIndex + 1];
                    GameState.cultivationProgress = 0;
                    
                    // ÊèêÂçáËßíËâ≤Âü∫Á°ÄÂ±ûÊÄß
                    GameState.character.baseHp += 50;
                    GameState.character.baseAttack += 20;
                    GameState.character.baseDefense += 10;
                    
                    // ‰ΩìË¥®Â¢ûÂä†ÔºàÊØèÂçá‰∏Ä‰∏™Â§ßÂ¢ÉÁïå‰ΩìË¥®+5Ôºâ
                    if (currentIndex % 3 === 0) {
                        GameState.character.baseConstitution += 10;
                        showNotification('‰ΩìË¥®ÊèêÂçá', `Á™ÅÁ†¥Â¢ÉÁïå‰Ωø‰Ω†ÁöÑ‰ΩìË¥®Ê∞∏‰πÖÊèêÂçá‰∫Ü10ÁÇπÔºÅ`);
                    }
                    
                    // ÈáçÊñ∞ËÆ°ÁÆóÂ±ûÊÄß
                    calculateAttributes();
                    
                    showNotification('Â¢ÉÁïåÁ™ÅÁ†¥', `ÊÅ≠ÂñúÔºÅ‰Ω†Â∑≤Á™ÅÁ†¥Âà∞${CULTIVATION_STAGES[currentIndex + 1]}ÔºÅ`);
                } else {
                    GameState.cultivationProgress = 100;
                    showNotification('Â§ßÂúÜÊª°', 'ÊÅ≠ÂñúÔºÅ‰Ω†Â∑≤ËææÂà∞È£ûÂçáÊúüÂ§ßÂúÜÊª°Â¢ÉÁïåÔºÅ');
                }
            }
            
            showNotification('Èó≠ÂÖ≥‰øÆÁÇº', `‰Ω†Èó≠ÂÖ≥‰øÆÁÇºËé∑Âæó‰∫Ü${progressGain}%ÁöÑËøõÂ∫¶ÔºÅÊ∂àËÄó${cultivationCost}ÁÅµÂäõ`);
            updateUI();
        }
        
        // ============================
        // ËæÖÂä©ÂäüËÉΩ
        // ============================
        
        // Êõ¥Êñ∞UI
        function updateUI() {
            // Êõ¥Êñ∞Âü∫Á°Ä‰ø°ÊÅØ
            document.getElementById('refresh-count').textContent = GameState.refreshCount;
            document.getElementById('refresh-counter').textContent = GameState.refreshCount;
            
            // Êõ¥Êñ∞ÁÅµÂäõÊòæÁ§∫
            document.getElementById('spirit-power').textContent = GameState.spiritPower.toLocaleString();
            document.getElementById('available-spirit').textContent = GameState.spiritPower.toLocaleString();
            
            // Êõ¥Êñ∞Á≠âÁ∫ßËøõÂ∫¶
            const levelProgress = Math.min(100, (GameState.character.experience / (GameState.character.level * 100)) * 100);
            document.getElementById('progress-fill').style.width = `${levelProgress}%`;
            document.getElementById('progress-text').textContent = 
                `Á≠âÁ∫ß ${GameState.character.level} ¬∑ ${levelProgress.toFixed(1)}%`;
            document.getElementById('stage-progress-value').textContent = levelProgress.toFixed(1);
            
            // Êõ¥Êñ∞Â¢ÉÁïå‰øÆÁÇºËøõÂ∫¶
            document.getElementById('cultivation-progress-fill').style.width = `${GameState.cultivationProgress}%`;
            document.getElementById('cultivation-progress-text').textContent = 
                `${GameState.cultivationStage} ¬∑ ${GameState.cultivationProgress}%`;
            document.getElementById('cultivation-progress-value').textContent = GameState.cultivationProgress;
            
            // Êõ¥Êñ∞ÊÄ™Áâ©‰ø°ÊÅØ
            document.getElementById('monster-name').textContent = GameState.monster.name;
            document.getElementById('monster-hp').textContent = GameState.monster.hp.toLocaleString();
            document.getElementById('monster-attack').textContent = GameState.monster.attack.toLocaleString();
            document.getElementById('monster-defense').textContent = GameState.monster.defense.toLocaleString();
            document.getElementById('monster-cultivation').textContent = GameState.monster.cultivation;
            
            // Êõ¥Êñ∞ËßíËâ≤‰ø°ÊÅØ
            document.getElementById('character-stage').textContent = GameState.cultivationStage;
            document.getElementById('character-level').textContent = GameState.character.level;
            document.getElementById('character-hp').textContent = `${Math.floor(GameState.character.hp)}/${Math.floor(GameState.character.maxHp)}`;
            document.getElementById('character-attack').textContent = Math.floor(GameState.character.attack);
            document.getElementById('character-defense').textContent = Math.floor(GameState.character.defense);
            document.getElementById('character-crit-rate').textContent = `${Math.min(80, Math.floor(GameState.character.critRate))}%`;
            document.getElementById('character-crit-dmg').textContent = `${Math.floor(GameState.character.critDmg)}%`;
            document.getElementById('character-dodge').textContent = `${Math.min(80, Math.floor(GameState.character.dodge))}%`;
            document.getElementById('character-lifeSteal').textContent = `${Math.min(80, Math.floor(GameState.character.lifeSteal))}%`;
            document.getElementById('character-combo').textContent = `${Math.min(80, Math.floor(GameState.character.combo))}%`;
            document.getElementById('character-constitution').textContent = Math.floor(GameState.character.constitution);
            
            // Êõ¥Êñ∞Â±ûÊÄßÈù¢Êùø
            document.getElementById('attack-value').textContent = Math.floor(GameState.character.baseAttack);
            document.getElementById('defense-value').textContent = Math.floor(GameState.character.baseDefense);
            document.getElementById('hp-value').textContent = Math.floor(GameState.character.baseHp);
            document.getElementById('constitution-value').textContent = Math.floor(GameState.character.baseConstitution);
            document.getElementById('attack-cost').textContent = GameState.attributeCosts.attack;
            document.getElementById('defense-cost').textContent = GameState.attributeCosts.defense;
            document.getElementById('hp-cost').textContent = GameState.attributeCosts.hp;
            document.getElementById('constitution-cost').textContent = GameState.attributeCosts.constitution;
            
            // Êõ¥Êñ∞ÊåÇÊú∫Áä∂ÊÄÅ
            const rewardMultiplier = 1 + (CULTIVATION_STAGES.indexOf(GameState.cultivationStage) * 0.3);
            const actualReward = Math.round(GameState.stageReward * rewardMultiplier);
            document.getElementById('current-reward').textContent = actualReward;
            document.getElementById('spirit-per-minute').textContent = actualReward;
            
            // Êõ¥Êñ∞Â¢ÉÁïåÊòæÁ§∫
            document.getElementById('current-stage').textContent = GameState.cultivationStage;
            document.getElementById('current-stage-display').textContent = GameState.cultivationStage;
            
            // Êõ¥Êñ∞ÂáªË¥•ÊÄ™Áâ©Êï∞
            document.getElementById('monster-defeated').textContent = GameState.monsterDefeated;
            
            // Êõ¥Êñ∞Ê∏∏ÊàèÊó∂Èó¥
            document.getElementById('game-time').textContent = formatTime(GameState.gameTime);
            
            // Êõ¥Êñ∞ÊúÄÂêé‰øùÂ≠òÊó∂Èó¥
            if (GameState.lastSaveTime) {
                document.getElementById('last-save').textContent = new Date(GameState.lastSaveTime).toLocaleTimeString().slice(0,5);
                document.getElementById('save-time').textContent = new Date(GameState.lastSaveTime).toLocaleString();
            } else {
                document.getElementById('save-time').textContent = 'Êú™‰øùÂ≠ò';
            }
            
            // Êõ¥Êñ∞Ëá™Âä®ÊàòÊñóÊåâÈíÆÁä∂ÊÄÅ
            const autoBattleBtn = document.getElementById('auto-battle-btn');
            if (GameState.autoBattleActive) {
                autoBattleBtn.classList.add('active');
                autoBattleBtn.innerHTML = '<i class="fas fa-stop"></i> ÂÅúÊ≠¢Ëá™Âä®ÊàòÊñó';
            } else {
                autoBattleBtn.classList.remove('active');
                autoBattleBtn.innerHTML = '<i class="fas fa-robot"></i> Ëá™Âä®ÊàòÊñó';
            }
            
            // Êõ¥Êñ∞‰øÆÁÇºÈÄüÂ∫¶ÊòæÁ§∫
            let cultivationSpeed = 100;
            GameState.selectedBuffs.forEach(buff => {
                if (buff.effect === "cultivationSpeed") {
                    cultivationSpeed += buff.value * 100;
                }
            });
            document.getElementById('character-cultivation-speed').textContent = `${cultivationSpeed}%`;
            
            // Êõ¥Êñ∞ÊàòÊñóÁä∂ÊÄÅÊòæÁ§∫
            document.getElementById('player-hp-display').textContent = `${Math.floor(GameState.character.hp)}/${Math.floor(GameState.character.maxHp)}`;
            document.getElementById('monster-hp-display').textContent = `${GameState.monster.hp.toLocaleString()}/${GameState.monster.maxHp.toLocaleString()}`;
        }
        
        // ÂºÄÂßãÂ§çÊ¥ªÂÄíËÆ°Êó∂
        function startResurrection() {
            const resurrectOverlay = document.getElementById('resurrect-overlay');
            const resurrectTimer = document.getElementById('resurrect-timer');
            resurrectOverlay.style.display = 'flex';
            
            // Á¶ÅÁî®ÊàòÊñóÊåâÈíÆ
            document.getElementById('attack-btn').disabled = true;
            document.getElementById('auto-battle-btn').disabled = true;
            
            let timeLeft = 5;
            resurrectTimer.textContent = timeLeft;
            
            const countdown = setInterval(() => {
                timeLeft--;
                resurrectTimer.textContent = timeLeft;
                
                if (timeLeft <= 0) {
                    clearInterval(countdown);
                    resurrectOverlay.style.display = 'none';
                    GameState.character.isAlive = true;
                    GameState.character.hp = GameState.character.maxHp;
                    
                    // ÂêØÁî®ÊàòÊñóÊåâÈíÆ
                    document.getElementById('attack-btn').disabled = false;
                    document.getElementById('auto-battle-btn').disabled = false;
                    
                    updateBattleInfo(`‰Ω†Â∑≤Â§çÊ¥ªÔºåÁîüÂëΩÂÄºÊÅ¢Â§çÊª°ÔºÅ`);
                    updateUI();
                }
            }, 1000);
        }
        
        // Âä†ËΩΩÊÄ™Áâ©
        function loadMonster(level) {
            GameState.monster = {...MONSTERS_BY_LEVEL[level]};
            GameState.monster.level = level;
            GameState.monster.hp = GameState.monster.maxHp;
            updateUI();
        }
        
        // ÂàùÂßãÂåñÊÄ™Áâ©ÈÄâÈ°π
        function initMonsterOptions() {
            const monsterSelection = document.getElementById('monster-selection');
            monsterSelection.innerHTML = '';
            
            for (let level = 1; level <= 9; level++) {
                const monster = MONSTERS_BY_LEVEL[level];
                const option = document.createElement('div');
                option.className = `monster-option ${level === 1 ? 'selected' : ''}`;
                option.dataset.level = level;
                option.innerHTML = `
                    <div class="monster-level">${monster.cultivation}Â¶ñÂÖΩ</div>
                    <div class="monster-reward">ÁÅµÂäõÂ•ñÂä±: ${monster.rewardMin}-${monster.rewardMax}</div>
                `;
                monsterSelection.appendChild(option);
            }
        }
        
        // Âä†ÁÇπÂ±ûÊÄß
        function addAttribute(attr) {
            const cost = GameState.attributeCosts[attr];
            
            if (GameState.spiritPower < cost) {
                showNotification('Âä†ÁÇπÂ§±Ë¥•', `ÁÅµÂäõ‰∏çË∂≥ÔºåÈúÄË¶Å${cost}ÁÇπÁÅµÂäõÔºÅ`);
                return;
            }
            
            GameState.spiritPower -= cost;
            
            // Â¢ûÂä†Âü∫Á°ÄÂ±ûÊÄß
            switch(attr) {
                case 'attack':
                    GameState.character.baseAttack += 5;
                    break;
                case 'defense':
                    GameState.character.baseDefense += 2;
                    break;
                case 'hp':
                    GameState.character.baseHp += 20;
                    GameState.character.hp += 20;
                    break;
                case 'critRate':
                    GameState.character.baseCritRate += 1;
                    break;
                case 'critDmg':
                    GameState.character.baseCritDmg += 10;
                    break;
                case 'dodge':
                    GameState.character.baseDodge += 1;
                    break;
                case 'lifeSteal':
                    GameState.character.baseLifeSteal += 1;
                    break;
                case 'combo':
                    GameState.character.baseCombo += 1;
                    break;
                case 'constitution':
                    GameState.character.baseConstitution += 1;
                    break;
            }
            
            // ÈáçÊñ∞ËÆ°ÁÆóÂ±ûÊÄß
            calculateAttributes();
            
            // Â¢ûÂä†‰∏ãÊ¨°Âä†ÁÇπÊ∂àËÄó
            GameState.attributeCosts[attr] = Math.round(cost * 1.2);
            
            showNotification('Â±ûÊÄßÊèêÂçá', `${getAttributeName(attr)}ÊèêÂçá‰∫ÜÔºÅ`);
            updateUI();
        }
        
        // Ëé∑ÂèñÂ±ûÊÄßÂêçÁß∞
        function getAttributeName(attr) {
            switch(attr) {
                case 'attack': return 'ÊîªÂáªÂäõ';
                case 'defense': return 'Èò≤Âæ°Âäõ';
                case 'hp': return 'ÁîüÂëΩÂÄº';
                case 'critRate': return 'Êö¥ÂáªÁéá';
                case 'critDmg': return 'Êö¥Âáª‰º§ÂÆ≥';
                case 'dodge': return 'Èó™ÈÅøÁéá';
                case 'lifeSteal': return 'Âê∏Ë°ÄÁéá';
                case 'combo': return 'ËøûÂáªÁéá';
                case 'constitution': return '‰ΩìË¥®';
                default: return '';
            }
        }
        
        // Ëá™Âä®ÊàòÊñó
        function toggleAutoBattle() {
            if (!GameState.character.isAlive) return;
            
            GameState.autoBattleActive = !GameState.autoBattleActive;
            
            if (GameState.autoBattleActive) {
                // ÂºÄÂßãËá™Âä®ÊàòÊñó
                updateBattleInfo('Ëá™Âä®ÊàòÊñóÂ∑≤ÂêØÂä®ÔºÅ');
                GameState.autoBattleInterval = setInterval(() => {
                    if (!GameState.character.isAlive || !GameState.autoBattleActive) {
                        toggleAutoBattle();
                        return;
                    }
                    
                    // ÊâßË°åÊîªÂáª
                    performAttack();
                }, 2000);
            } else {
                // ÂÅúÊ≠¢Ëá™Âä®ÊàòÊñó
                updateBattleInfo('Ëá™Âä®ÊàòÊñóÂ∑≤ÂÅúÊ≠¢ÔºÅ');
                clearInterval(GameState.autoBattleInterval);
                GameState.autoBattleInterval = null;
            }
            
            updateUI();
        }
        
        // ============================
        // Â≠òÊ°£/ËØªÊ°£Á≥ªÁªü
        // ============================
        
        // ‰øùÂ≠òÊ∏∏Êàè
        function saveGame() {
            const saveData = {
                version: GameState.VERSION,
                spiritPower: GameState.spiritPower,
                cultivationStage: GameState.cultivationStage,
                stageProgress: GameState.stageProgress,
                cultivationProgress: GameState.cultivationProgress,
                selectedBuffs: GameState.selectedBuffs,
                character: GameState.character,
                monsterDefeated: GameState.monsterDefeated,
                gameTime: GameState.gameTime,
                equipment: GameState.equipment,
                inventory: GameState.inventory,
                autoRecycle: GameState.autoRecycle,
                settings: GameState.settings,
                lastSaveTime: Date.now()
            };
            
            try {
                localStorage.setItem('cultivation_save', JSON.stringify(saveData));
                GameState.lastSaveTime = Date.now();
                showSaveNotification();
                showNotification('Ê∏∏Êàè‰øùÂ≠ò', 'Ê∏∏ÊàèËøõÂ∫¶Â∑≤‰øùÂ≠òÔºÅ');
                updateUI();
            } catch (e) {
                showNotification('‰øùÂ≠òÂ§±Ë¥•', '‰øùÂ≠òÊ∏∏ÊàèÊï∞ÊçÆÂ§±Ë¥•ÔºåËØ∑Ê£ÄÊü•ÊµèËßàÂô®ËÆæÁΩÆ');
            }
        }
        
        // ÊòæÁ§∫Â≠òÊ°£ÊèêÁ§∫
        function showSaveNotification() {
            const saveNotification = document.getElementById('save-notification');
            saveNotification.classList.add('show');
            
            setTimeout(() => {
                saveNotification.classList.remove('show');
            }, 2000);
        }
        
        // Â§çÂà∂Â≠òÊ°£Âà∞Ââ™Ë¥¥Êùø
        function copySaveToClipboard() {
            const saveData = {
                version: GameState.VERSION,
                spiritPower: GameState.spiritPower,
                cultivationStage: GameState.cultivationStage,
                stageProgress: GameState.stageProgress,
                cultivationProgress: GameState.cultivationProgress,
                selectedBuffs: GameState.selectedBuffs,
                character: GameState.character,
                monsterDefeated: GameState.monsterDefeated,
                gameTime: GameState.gameTime,
                equipment: GameState.equipment,
                inventory: GameState.inventory,
                autoRecycle: GameState.autoRecycle,
                settings: GameState.settings,
                lastSaveTime: Date.now()
            };
            
            const dataStr = JSON.stringify(saveData, null, 2);
            
            navigator.clipboard.writeText(dataStr).then(() => {
                showNotification('Â§çÂà∂ÊàêÂäü', 'Â≠òÊ°£Êï∞ÊçÆÂ∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥ÊùøÔºÅ');
                document.getElementById('copy-status').textContent = 'Â§çÂà∂ÊàêÂäüÔºÅ';
                document.getElementById('copy-status').style.color = '#2e8b57';
                
                setTimeout(() => {
                    document.getElementById('copy-status').textContent = '';
                }, 3000);
            }).catch(err => {
                showNotification('Â§çÂà∂Â§±Ë¥•', 'Â§çÂà∂Âà∞Ââ™Ë¥¥ÊùøÂ§±Ë¥•ÔºåËØ∑ÊâãÂä®Â§çÂà∂');
                document.getElementById('copy-status').textContent = 'Â§çÂà∂Â§±Ë¥•ÔºåËØ∑ÊâãÂä®Â§çÂà∂';
                document.getElementById('copy-status').style.color = '#dc143c';
                
                // Â§áÈÄâÊñπÊ°àÔºöÂàõÂª∫ÊñáÊú¨Âå∫Âüü
                const textArea = document.createElement('textarea');
                textArea.value = dataStr;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                
                setTimeout(() => {
                    document.getElementById('copy-status').textContent = 'Â∑≤‰ΩøÁî®Â§áÈÄâÊñπÊ°àÂ§çÂà∂';
                }, 1000);
            });
        }
        
        // ‰ªéÂâ™Ë¥¥ÊùøÁ≤òË¥¥Â≠òÊ°£
        function pasteSaveFromClipboard() {
            navigator.clipboard.readText().then(text => {
                try {
                    const saveData = JSON.parse(text);
                    
                    // Ê£ÄÊü•ÁâàÊú¨ÂÖºÂÆπÊÄß
                    if (saveData.version && saveData.version.startsWith('4.')) {
                        if (confirm('Á≤òË¥¥Â≠òÊ°£Â∞ÜË¶ÜÁõñÂΩìÂâçËøõÂ∫¶ÔºåÁ°ÆÂÆöË¶ÅÁ≤òË¥¥ÂêóÔºü')) {
                            // Âä†ËΩΩÊï∞ÊçÆ
                            GameState.spiritPower = saveData.spiritPower || 0;
                            GameState.cultivationStage = saveData.cultivationStage || 'ÁÇºÊ∞îÂàùÊúü';
                            GameState.stageProgress = saveData.stageProgress || 0;
                            GameState.cultivationProgress = saveData.cultivationProgress || 0;
                            GameState.selectedBuffs = saveData.selectedBuffs || [];
                            GameState.character = {...GameState.character, ...saveData.character};
                            GameState.monsterDefeated = saveData.monsterDefeated || 0;
                            GameState.gameTime = saveData.gameTime || 0;
                            GameState.equipment = saveData.equipment || GameState.equipment;
                            GameState.inventory = saveData.inventory || GameState.inventory;
                            GameState.autoRecycle = saveData.autoRecycle || GameState.autoRecycle;
                            GameState.settings = {...GameState.settings, ...saveData.settings};
                            GameState.lastSaveTime = saveData.lastSaveTime;
                            
                            // ÈáçÊñ∞ËÆ°ÁÆóÂ±ûÊÄß
                            calculateAttributes();
                            
                            // Êõ¥Êñ∞UI
                            updateUI();
                            updateAutoRecycleUI();
                            updateBuffsDisplay();
                            updateEquipmentDisplay();
                            updateInventoryDisplay();
                            
                            showNotification('Â≠òÊ°£Á≤òË¥¥', 'Â≠òÊ°£Êï∞ÊçÆÁ≤òË¥¥ÊàêÂäüÔºÅ');
                            document.getElementById('paste-status').textContent = 'Á≤òË¥¥ÊàêÂäüÔºÅ';
                            document.getElementById('paste-status').style.color = '#2e8b57';
                            
                            setTimeout(() => {
                                document.getElementById('paste-status').textContent = '';
                            }, 3000);
                        }
                    } else {
                        showNotification('Á≤òË¥¥Â§±Ë¥•', 'Â≠òÊ°£ÁâàÊú¨‰∏çÂÖºÂÆπÔºÅ');
                        document.getElementById('paste-status').textContent = 'Á≤òË¥¥Â§±Ë¥•ÔºöÁâàÊú¨‰∏çÂÖºÂÆπ';
                        document.getElementById('paste-status').style.color = '#dc143c';
                    }
                } catch (error) {
                    showNotification('Á≤òË¥¥Â§±Ë¥•', 'Ââ™Ë¥¥ÊùøÊï∞ÊçÆÊ†ºÂºèÈîôËØØÔºÅ');
                    document.getElementById('paste-status').textContent = 'Á≤òË¥¥Â§±Ë¥•ÔºöÊï∞ÊçÆÊ†ºÂºèÈîôËØØ';
                    document.getElementById('paste-status').style.color = '#dc143c';
                }
            }).catch(err => {
                showNotification('Á≤òË¥¥Â§±Ë¥•', 'Êó†Ê≥ïËØªÂèñÂâ™Ë¥¥ÊùøÔºåËØ∑Ê£ÄÊü•ÊùÉÈôê');
                document.getElementById('paste-status').textContent = 'Á≤òË¥¥Â§±Ë¥•ÔºöÊó†Ê≥ïËØªÂèñÂâ™Ë¥¥Êùø';
                document.getElementById('paste-status').style.color = '#dc143c';
            });
        }
        
        // Âä†ËΩΩÊ∏∏Êàè
        function loadGameData() {
            try {
                const savedData = localStorage.getItem('cultivation_save');
                if (savedData) {
                    const data = JSON.parse(savedData);
                    
                    // Ê£ÄÊü•ÁâàÊú¨ÂÖºÂÆπÊÄß
                    if (data.version && data.version.startsWith('4.')) {
                        // Âä†ËΩΩÊï∞ÊçÆ
                        GameState.spiritPower = data.spiritPower || 0;
                        GameState.cultivationStage = data.cultivationStage || 'ÁÇºÊ∞îÂàùÊúü';
                        GameState.stageProgress = data.stageProgress || 0;
                        GameState.cultivationProgress = data.cultivationProgress || 0;
                        GameState.selectedBuffs = data.selectedBuffs || [];
                        GameState.character = {...GameState.character, ...data.character};
                        GameState.monsterDefeated = data.monsterDefeated || 0;
                        GameState.gameTime = data.gameTime || 0;
                        GameState.equipment = data.equipment || GameState.equipment;
                        GameState.inventory = data.inventory || GameState.inventory;
                        GameState.autoRecycle = data.autoRecycle || GameState.autoRecycle;
                        GameState.settings = {...GameState.settings, ...data.settings};
                        GameState.lastSaveTime = data.lastSaveTime;
                        
                        // ÈáçÊñ∞ËÆ°ÁÆóÂ±ûÊÄß
                        calculateAttributes();
                        
                        return true;
                    } else {
                        console.log('Â≠òÊ°£ÁâàÊú¨‰∏çÂÖºÂÆπÔºå‰ΩøÁî®Êñ∞Ê∏∏Êàè');
                    }
                }
            } catch (e) {
                console.error('Âä†ËΩΩÂ≠òÊ°£Â§±Ë¥•:', e);
            }
            
            return false;
        }
        
        // ÂºÄÂßãËá™Âä®‰øùÂ≠ò
        function startAutoSave() {
            if (GameState.settings.autosaveEnabled) {
                setInterval(() => {
                    saveGame();
                }, GameState.settings.saveInterval);
            }
        }
        
        // ÂºÄÂßãÊ∏∏ÊàèËÆ°Êó∂Âô®
        function startGameTimer() {
            setInterval(() => {
                GameState.gameTime++;
                if (GameState.gameTime % 60 === 0) {
                    updateUI(); // ÊØèÂàÜÈíüÊõ¥Êñ∞‰∏ÄÊ¨°Êó∂Èó¥ÊòæÁ§∫
                }
            }, 1000);
        }
        
        // Ê†ºÂºèÂåñÊó∂Èó¥
        function formatTime(seconds) {
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            const secs = seconds % 60;
            
            return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }
        
        // ÈáçÁΩÆÊ∏∏Êàè
        function resetGame() {
            if (confirm('Á°ÆÂÆöË¶ÅÈáçÁΩÆÊ∏∏ÊàèÂêóÔºüËøôÂ∞ÜÊ∏ÖÈô§ÊâÄÊúâËøõÂ∫¶Âπ∂ÈáçÊñ∞ÂºÄÂßãÔºÅ')) {
                // Ê∏ÖÈô§Êú¨Âú∞Â≠òÂÇ®
                localStorage.removeItem('cultivation_save');
                
                // ÈáçÊñ∞Âä†ËΩΩÈ°µÈù¢
                location.reload();
            }
        }
        
        // ============================
        // ÁßªÂä®Á´ØÂØºËà™
        // ============================
        
        function setupMobileNavigation() {
            const navItems = document.querySelectorAll('.nav-item');
            
            navItems.forEach(item => {
                item.addEventListener('click', function() {
                    const target = this.dataset.target;
                    
                    // ÁßªÈô§ÊâÄÊúâÊøÄÊ¥ªÁä∂ÊÄÅ
                    navItems.forEach(nav => nav.classList.remove('active'));
                    
                    // Ê∑ªÂä†ÂΩìÂâçÊøÄÊ¥ªÁä∂ÊÄÅ
                    this.classList.add('active');
                    
                    // Â§ÑÁêÜÁÇπÂáªÂä®‰Ωú
                    switch(target) {
                        case 'talent-panel':
                            document.getElementById('talent-panel').style.display = 'block';
                            document.getElementById('attribute-panel').style.display = 'none';
                            break;
                        case 'attribute-panel':
                            document.getElementById('talent-panel').style.display = 'none';
                            document.getElementById('attribute-panel').style.display = 'block';
                            break;
                        case 'cultivate-btn':
                            handleCultivation();
                            break;
                        case 'monster-battle':
                            // ÊªöÂä®Âà∞ÊÄ™Áâ©ÊàòÊñóÂå∫Âüü
                            document.getElementById('monster-battle').scrollIntoView({behavior: 'smooth'});
                            break;
                        case 'equipment-content':
                            // ÂàáÊç¢Âà∞Ë£ÖÂ§áÊ†áÁ≠æ
                            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
                            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                            document.querySelector('[data-tab="equipment"]').classList.add('active');
                            document.getElementById('equipment-content').classList.add('active');
                            // ÊòæÁ§∫Â§©ËµãÈù¢Êùø
                            document.getElementById('talent-panel').style.display = 'block';
                            document.getElementById('attribute-panel').style.display = 'none';
                            break;
                    }
                });
            });
        }
        
        // ============================
        // Ëß¶Êë∏‰∫ã‰ª∂Â§ÑÁêÜ
        // ============================
        
        function setupTouchEvents() {
            let touchStartTime = 0;
            
            // ÈïøÊåâ‰∫ã‰ª∂Â§ÑÁêÜ
            document.addEventListener('touchstart', function(e) {
                touchStartTime = Date.now();
                
                const equipmentSlot = e.target.closest('.equipment-slot');
                if (equipmentSlot) {
                    const slotType = equipmentSlot.dataset.slot;
                    
                    // ËÆæÁΩÆÈïøÊåâÂÆöÊó∂Âô®
                    equipmentSlot.longPressTimer = setTimeout(() => {
                        let item = null;
                        item = GameState.equipment[slotType];
                        
                        if (item && confirm(`Á°ÆÂÆöËÑ±‰∏ã„Äê${item.name}„ÄëÂêóÔºü`)) {
                            unequipItem(slotType);
                        }
                    }, 1000); // 1ÁßíÈïøÊåâ
                }
            }, { passive: true });
            
            document.addEventListener('touchend', function(e) {
                // Ê∏ÖÈô§ÈïøÊåâÂÆöÊó∂Âô®
                const equipmentSlot = e.target.closest('.equipment-slot');
                if (equipmentSlot && equipmentSlot.longPressTimer) {
                    clearTimeout(equipmentSlot.longPressTimer);
                }
            });
            
            // ÂèåÂáª‰∫ã‰ª∂Â§ÑÁêÜ
            let lastTap = 0;
            document.addEventListener('touchend', function(e) {
                const inventoryItem = e.target.closest('.inventory-item');
                if (inventoryItem) {
                    const currentTime = Date.now();
                    const tapLength = currentTime - lastTap;
                    
                    if (tapLength < 300 && tapLength > 0) {
                        // ÂèåÂáª‰∫ã‰ª∂
                        const itemIndex = parseInt(inventoryItem.dataset.index);
                        const item = GameState.inventory[itemIndex];
                        
                        if (item) {
                            equipItem(itemIndex);
                        }
                    }
                    lastTap = currentTime;
                }
            });
        }
        
        // ============================
        // ÂàùÂßãÂåñ‰∫ã‰ª∂ÁõëÂê¨
        // ============================
        
        document.addEventListener('DOMContentLoaded', () => {
            initGame();
            setupMobileNavigation();
            setupTouchEvents();
            
            // Â§©ËµãÈÄâÊã©
            document.getElementById('buff-container').addEventListener('click', (e) => {
                const buffCard = e.target.closest('.buff-card');
                if (!buffCard) return;
                
                // ÈîÅÂÆöÊåâÈíÆÂ§ÑÁêÜ
                if (e.target.closest('.lock-icon')) {
                    e.stopPropagation();
                    const index = parseInt(buffCard.dataset.index);
                    toggleBuffLock(index);
                    return;
                }
                const index = parseInt(buffCard.dataset.index);
                toggleBuffSelection(index);
            });
            
            // Âà∑Êñ∞Â§©ËµãÊåâÈíÆ
            document.getElementById('refresh-btn').addEventListener('click', refreshBuffs);
            
            // ÂºÄÂßã‰øÆ‰ªôÊåâÈíÆ
            document.getElementById('start-btn').addEventListener('click', () => {
                showNotification('‰øÆ‰ªôÂºÄÂßã', '‰øÆ‰ªô‰πãË∑ØÊ≠£ÂºèÂºÄÂêØÔºÅÁ•ùÈÅìÂèãÊó©Êó•ÂæóÈÅìÊàê‰ªôÔºÅ');
                
                // ÈöêËóèÂ§©ËµãÈù¢ÊùøÔºåÊòæÁ§∫Â±ûÊÄßÈù¢Êùø
                document.getElementById('talent-panel').style.display = 'none';
                document.getElementById('attribute-panel').style.display = 'block';
                
                // ÂêØÁî®‰øÆÁÇºÂäüËÉΩ
                document.getElementById('cultivate-btn').disabled = false;
                
                // ÂºÄÂßã‰øÆÁÇº
                startCultivation();
                updateUI();
                
                // Êõ¥Êñ∞ÂØºËà™ÊøÄÊ¥ªÁä∂ÊÄÅ
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.classList.remove('active');
                    if (item.dataset.target === 'attribute-panel') {
                        item.classList.add('active');
                    }
                });
                
                // ÊòæÁ§∫ÈáçÁΩÆÊ∏∏ÊàèÊåâÈíÆ
                document.getElementById('reset-game-btn-2').style.display = 'block';
            });
            
            // Èó≠ÂÖ≥‰øÆÁÇºÊåâÈíÆ
            document.getElementById('cultivate-btn').addEventListener('click', handleCultivation);
            
            // ÊàòÊñóÊåâÈíÆ
            document.getElementById('attack-btn').addEventListener('click', () => {
                handleBattleAction('attack');
            });
            
            // Ëá™Âä®ÊàòÊñóÊåâÈíÆ
            document.getElementById('auto-battle-btn').addEventListener('click', toggleAutoBattle);
            
            // ÊÄ™Áâ©ÈÄâÊã©
            document.getElementById('monster-selection').addEventListener('click', function(e) {
                const monsterOption = e.target.closest('.monster-option');
                if (monsterOption) {
                    // ÁßªÈô§ÂÖ∂‰ªñÈÄâÈ°πÁöÑÈÄâÊã©Áä∂ÊÄÅ
                    document.querySelectorAll('.monster-option').forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    
                    // ËÆæÁΩÆÂΩìÂâçÈÄâÈ°π‰∏∫ÈÄâ‰∏≠Áä∂ÊÄÅ
                    monsterOption.classList.add('selected');
                    
                    // Âä†ËΩΩÂØπÂ∫îÁ≠âÁ∫ßÁöÑÊÄ™Áâ©
                    const level = parseInt(monsterOption.dataset.level);
                    loadMonster(level);
                    updateBattleInfo(`‰Ω†ÈÄâÊã©‰∫ÜÊåëÊàò${MONSTERS_BY_LEVEL[level].name}ÔºÅ`);
                }
            });
            
            // Â±ûÊÄßÂä†ÁÇπ
            document.querySelectorAll('.stat-card-add').forEach(btn => {
                btn.addEventListener('click', function() {
                    const attr = this.dataset.attr;
                    addAttribute(attr);
                });
            });
            
            // Â±ûÊÄßÂä†ÁÇπÈù¢Êùø
            document.querySelectorAll('.attribute-add').forEach(btn => {
                btn.addEventListener('click', function() {
                    const attr = this.dataset.attr;
                    addAttribute(attr);
                });
            });
            
            // ÈÄâÈ°πÂç°ÂàáÊç¢
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.dataset.tab;
                    
                    // ÁßªÈô§ÊâÄÊúâÊøÄÊ¥ªÁä∂ÊÄÅ
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    
                    // Ê∑ªÂä†ÂΩìÂâçÊøÄÊ¥ªÁä∂ÊÄÅ
                    this.classList.add('active');
                    document.getElementById(`${tabId}-content`).classList.add('active');
                    
                    // Â¶ÇÊûúÊòØË£ÖÂ§áÊ†áÁ≠æÔºåÊõ¥Êñ∞ËÉåÂåÖÊòæÁ§∫
                    if (tabId === 'equipment') {
                        updateInventoryDisplay();
                    }
                    // Â¶ÇÊûúÊòØËá™Âä®ÂõûÊî∂Ê†áÁ≠æÔºåÊõ¥Êñ∞ËÆæÁΩÆÊòæÁ§∫
                    else if (tabId === 'recycle') {
                        updateAutoRecycleUI();
                    }
                    // Â¶ÇÊûúÊòØÂ≠òÊ°£Ê†áÁ≠æÔºåÊõ¥Êñ∞Â≠òÊ°£‰ø°ÊÅØ
                    else if (tabId === 'saves') {
                        updateUI();
                    }
                });
            });
            
            // Ë£ÖÂ§áÊ†èÁÇπÂáª
            document.getElementById('equipment-grid').addEventListener('click', (e) => {
                const equipmentSlot = e.target.closest('.equipment-slot');
                if (equipmentSlot) {
                    const slotType = equipmentSlot.dataset.slot;
                    
                    // Â¶ÇÊûúË£ÖÂ§áÊßΩÊúâË£ÖÂ§áÔºåÊòæÁ§∫ËØ¶ÊÉÖ
                    const item = GameState.equipment[slotType];
                    if (item) {
                        showEquipmentDetails(item);
                    } else {
                        // Â¶ÇÊûúÊ≤°ÊúâË£ÖÂ§áÔºåÊòæÁ§∫ÂèØ‰ª•Á©øÊà¥ÁöÑË£ÖÂ§á
                        showEquipmentDetails(null);
                    }
                }
            });
            
            // ËÉåÂåÖÁâ©ÂìÅÁÇπÂáª
            document.getElementById('inventory-grid').addEventListener('click', (e) => {
                const inventoryItem = e.target.closest('.inventory-item');
                if (inventoryItem) {
                    const itemIndex = parseInt(inventoryItem.dataset.index);
                    
                    // ÂàáÊç¢ÈÄâ‰∏≠Áä∂ÊÄÅ
                    if (GameState.selectedInventoryItem === itemIndex) {
                        GameState.selectedInventoryItem = null;
                    } else {
                        GameState.selectedInventoryItem = itemIndex;
                    }
                    
                    // Êõ¥Êñ∞ËÉåÂåÖÊòæÁ§∫
                    updateInventoryDisplay();
                    
                    // ÊòæÁ§∫Ë£ÖÂ§áËØ¶ÊÉÖ
                    const item = GameState.inventory[itemIndex];
                    if (item) {
                        showEquipmentDetails(item);
                    }
                }
            });
            
            // Ë£ÖÂ§áÊ†èÂè≥ÈîÆÁÇπÂáªÔºàËÑ±‰∏ãË£ÖÂ§áÔºâ- Ê°åÈù¢Á´Ø
            document.getElementById('equipment-grid').addEventListener('contextmenu', (e) => {
                e.preventDefault();
                const equipmentSlot = e.target.closest('.equipment-slot');
                if (equipmentSlot) {
                    const slotType = equipmentSlot.dataset.slot;
                    
                    const item = GameState.equipment[slotType];
                    
                    if (item && confirm(`Á°ÆÂÆöËÑ±‰∏ã„Äê${item.name}„ÄëÂêóÔºü`)) {
                        unequipItem(slotType);
                    }
                }
            });
            
            // ËÉåÂåÖÁâ©ÂìÅÂèåÂáªÔºàÁ©øÊà¥Ë£ÖÂ§áÔºâ- Ê°åÈù¢Á´Ø
            document.getElementById('inventory-grid').addEventListener('dblclick', (e) => {
                const inventoryItem = e.target.closest('.inventory-item');
                if (inventoryItem) {
                    const itemIndex = parseInt(inventoryItem.dataset.index);
                    const item = GameState.inventory[itemIndex];
                    
                    if (item) {
                        equipItem(itemIndex);
                    }
                }
            });
            
            // Âá∫ÂîÆË£ÖÂ§áÊåâÈíÆ
            document.getElementById('sell-equipment-btn').addEventListener('click', sellSelectedEquipment);
            
            // Ëá™Âä®ÂõûÊî∂ÂäüËÉΩ
            document.getElementById('manual-recycle-btn').addEventListener('click', manualRecycleBackpack);
            document.getElementById('save-settings-btn').addEventListener('click', saveAutoRecycleSettings);
            
            // Â≠òÊ°£ÁÆ°ÁêÜÂäüËÉΩ
            document.getElementById('copy-save-btn').addEventListener('click', copySaveToClipboard);
            document.getElementById('paste-save-btn').addEventListener('click', pasteSaveFromClipboard);
            document.getElementById('quick-save-btn').addEventListener('click', saveGame);
            document.getElementById('load-last-btn').addEventListener('click', () => {
                if (confirm('Âä†ËΩΩ‰∏äÊ¨°Â≠òÊ°£Â∞ÜË¶ÜÁõñÂΩìÂâçËøõÂ∫¶ÔºåÁ°ÆÂÆöË¶ÅÂä†ËΩΩÂêóÔºü')) {
                    location.reload(); // ÈáçÊñ∞Âä†ËΩΩÈ°µÈù¢‰ºöËá™Âä®Âä†ËΩΩÂ≠òÊ°£
                }
            });
            
            // ÈáçÁΩÆÊ∏∏ÊàèÊåâÈíÆ
            document.getElementById('reset-game-btn').addEventListener('click', resetGame);
            document.getElementById('reset-game-btn-2').addEventListener('click', resetGame);
            
            // ÁâàÊú¨ÊòæÁ§∫
            document.getElementById('save-version').textContent = GameState.VERSION;
        });
    </script>
</body>
</html>